<include file="Public:header" />
<div class="dianpu_box">
  <div class="SellerCon">
    <div class="SellerTop">
      <h3>创建店铺</h3>
    </div>
    <div class="SellerFlower">
      <div class="paiuncenter_one">
        <h3>免费入驻</h3>
        <p class="activedp">申请的店铺完全免费，一个账号一个身份只能开一家店；申请到正式开通预计需要1~3个工作日。</p>
        <notempty name="res.return">
          <p style="color: red">退回原因：{$res.return}</p>
        </notempty>
      </div>
      <div class="SellerFlist SellerFlistCurr"> <span>4</span>
        <h3 class="paiUncenter_h3">身份验证</h3>
      </div>
      <div class="clear"></div>
       <div class="SellerTop" style="margin-top:20px">
        <h3>身份验证</h3>
        <p>请上传本人身份证件，确保图片清晰，四角完整</p>
        </div>
      <div class="pZlCon">
        <form class="pZlConForm">
          <div class="pZlConI clearfix">
            <label class="pzLs">姓名：</label>
            <input type="text" value="{$res.name}" maxlength="10" onblur="value=value.replace(/[^\u4e00-\u9fa5]/g,'')" onkeyup="value=value.replace(/[^\u4e00-\u9fa5]/g,'')" id="name">
           </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">主页名称：</label>
            <input type="text" value="{$res.zy_name}" maxlength="30" name="zy_name" id="zy_name">
           </div> 
          <div class="pZlConI clearfix">
            <label class="pzLs">您的等级：</label>
            <select name="level_id" id="level">
              <volist name="level" id="v">
                <option value="{$v.id}" <eq name="res.level" value="$v.id">selected</eq>>{$v.level_name}</option>
              </volist>
            </select>
          </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">手机号：</label>
            <input type="text" value="{$res.tel}" maxlength="16" onblur="value=value.replace(/[^0-9]/g,'')" onkeyup="value=value.replace(/[^0-9]/g,'')"  id="tel">
          </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">身份证号：</label>
            <input type="text" value="{$res.f_card}" maxlength="30"  id="cardid">
          </div>
           <div class="pZlConI clearfix">
            <div class="pZlConI-div">
              <label class="pzLs">证件图片：</label>
              <div class="SelIdetPic-list">
                <div class="SelIdPic-border" id="s">
                  <empty name="res.f_zpic">
                    <img src="__IMAGES__/SeladdPic.png">
                    <h6>点此上传</h6>
                    <input type="hidden" name="pic1" id="pic1" value=""/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="logo_pic" id="upFile">
                    <else/>
                    <img src="{$res.f_zpic}" style="width: 100% !important;">
                    <input type="hidden" name="logo_pic" id="pic1" value="{$res.f_zpic}">
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="logo_pic" id="upFile">
                  </empty>
                </div>
              </div>
              <div class="SelIdetPic-list">
                <div class="SelIdPic-border" id="ss">
                  <empty name="res.f_fpic">
                    <img src="__IMAGES__/SeladdPic.png">
                    <h6>点此上传</h6>
                    <input type="hidden" name="pic2" id="pic2" value=""/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="index_pic" id="upFile1">
                    <else/>
                    <img src="{$res.f_fpic}" style="width: 100% !important;">
                    <input type="hidden" name="pic2" id="pic2" value="{$res.f_fpic}"/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="index_pic" id="upFile1">
                  </empty>

                </div>
              </div>
            </div>
            
          </div>
          <div class="pZlConI clearfix">
            <div class="pZlConI-div">
              <label class="pzLs">个人图片：</label>
              <div class="SelIdetPic-list">
                <div class="SelIdPic-border" id="sss">
                  <empty name="res.logo_pic">
                    <img src="__IMAGES__/SeladdPic.png">
                    <h6>点此上传</h6>
                    <input type="hidden" name="pic3" id="pic3" value=""/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="upFile2" id="upFile2">
                    <else/>
                    <img src="{$res.logo_pic}" style="width: 100% !important;">
                    <input type="hidden" name="pic3" id="pic3" value="{$res.logo_pic}"/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="upFile2" id="upFile2">
                  </empty>

                </div>
              </div>
              
            </div>
            <h5>建议大小（宽368px 高434px）</h5>
          </div>
          <div class="pZlConI clearfix">
            <div class="pZlConI-div">
              <label class="pzLs">主页图片：</label>
              <div class="SelIdetPic-list">
                <div class="SelIdPic-border" id="ssss">
                  <empty name="res.zy_pic">
                    <img src="__IMAGES__/SeladdPic.png">
                    <h6>点此上传</h6>
                    <input type="hidden" name="pic4" id="pic4" value=""/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="upFile3" id="upFile3">
                    <else/>
                    <img src="{$res.zy_pic}" style="width: 100% !important;">
                    <input type="hidden" name="pic4" id="pic4" value="{$res.zy_pic}"/>
                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="upFile3" id="upFile3">
                  </empty>
                </div>
              </div>
              
            </div>
            <h5>建议大小（宽270px 高425px）</h5>
          </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">居住地址：</label>
            <span>
            <select id="s_province" name="s_province">
            </select>
            <select id="s_city" name="s_city">
            </select>
            <select id="s_county" name="s_county">
            </select>
            </span> <span>当前店铺经营联系人的手机，方便小二联系</span> 
          </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">详细地址：</label>
            <input type="text" value="{$res.address}" maxlength="30" id="address">
          </div>
          <div class="pZlConI clearfix">
            <label class="pzLs">个人简介：</label>
            <textarea name="desc" id="desc" rows="5" cols="30" style="width:100%">{$res.desc}</textarea>
          </div>
         
        </form>
        <div class="SelNoticeStyle">
          
          <h4><a href="javascript:void(0)" id="btn">确定提交</a></h4>
        </div>
      </div>
     
    </div>
  </div>
</div>

<div class="indexbottom"></div>

<include file="Public:footer" />
<script src="__JS__/jquery-form.js"></script>
<script class="resources library" src="__JS__/area.js" type="text/javascript"></script>
<script type="text/javascript">_init_area();</script>
<script>
  var province = "{$res['s_province']}";
  var city = "{$res['s_city']}";
  var district = "{$res['s_county']}";
  $("#s_province option").each(function () {
    if ($(this).val() == province) {
      $(this).attr('selected', true);
    }
  });
  $("#s_city option").each(function () {
    if ($(this).val() == province) {
      $(this).attr('selected', true);
    }
  });

  $('#s_city').html("");
  $('#s_county').html("");
  var _ct = "<option value=" + city + " >" + city + "</option>";
  var _dt = "<option value=" + district + ">" + district + "</option>";
  $('#s_city').append(_ct);
  $('#s_county').append(_dt);
  function upFile3(){
    var percent = $('.baotuan_percent');
    var progress = $('.baotuan_percent');
    $("#upFile3").wrap("<form id='baotuan2' action='{:U('/Wxin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#upFile3").change(function(){ //选择文件
      $("#baotuan2").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" style="width: 100% !important;" ><input type="hidden" name="goods_cap_pic" id="pic4" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"/><input type="file" accept="image/jpg,image/jpeg,image/png" name="serial" id="baotuan">';
          $('#ssss').html(img);
          upFile3();
          progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });
  }

  function upFile2(){
    var percent = $('.baotuan_percent');
    var progress = $('.baotuan_percent');
    $("#upFile2").wrap("<form id='baotuan1' action='{:U('/Wxin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#upFile2").change(function(){ //选择文件
      $("#baotuan1").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" style="width: 100% !important;" ><input type="hidden" name="goods_cap_pic" id="pic3" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"/><input type="file" accept="image/jpg,image/jpeg,image/png" name="serial" id="baotuan">';
          $('#sss').html(img);
          upFile2();
          progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });
  }

  function upFile1(){
    $("#upFile1").wrap("<form id='formupFiles1' action='{:U('/Wxin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#upFile1").change(function(){ //选择文件
      $("#formupFiles1").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          // progress.show(); //显示进度条
          var percentVal = '0%';
          // percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          //percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" style="width: 100% !important;" ><input type="hidden" name="index_pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"/><input type="file" accept="image/jpg,image/jpeg,image/png" name="index_pic" id="upFile1">';
          //$('.xuanze_showimge').html(img);
          $('#ss').html(img);
          upFile1();
          //progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });
  }

  function upFile(){
    $("#upFile").wrap("<form id='formupFiles' action='{:U('/Wxin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#upFile").change(function(){ //选择文件
      $("#formupFiles").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          //progress.show(); //显示进度条
          var percentVal = '0%';
          //percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          //percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" style="width: 100% !important;" ><input type="hidden" name="logo_pic" id="pic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"/><input type="file" accept="image/jpg,image/jpeg,image/png" name="logo_pic" id="upFile">';
          //$('.xuanze_showimge').html(img);
          $('#s').html(img);
          upFile();
          //progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });
  }
  $(function () {
    upFile();
    upFile1();
    upFile2();
    upFile3();
  });

  $('#btn').click(function () {
    var province = $.trim($('#s_province').val()); //现居住地址
    var city = $.trim($('#s_city').val());    //城市
    var district = $.trim($('#s_county').val());
    var name = $.trim($('#name').val());
    var zy_name = $.trim($('#zy_name').val());
    var tel = $.trim($('#tel').val());
    var cardid = $.trim($('#cardid').val());
    //var  type= $('input:radio[name="SelCinput"]:checked').val();
    var pic1 = $('#pic1').val();
    var pic2 = $('#pic2').val();
    var display_pic = $('#pic3').val();
    var zy_pic = $('#pic4').val();
//       / console.log(zy_pic);return false;
    var address = $.trim($('#address').val());
    var desc = $('#desc').val();
    var level = $('#level option:selected').val();
    //console.log(level);
    //alert(level);return false;
    if(name==""){
      alert("姓名必填");
      return false;
    }

    if(zy_name==""){
      alert("主页名称必填");
      return false;
    }
    if(tel==""){
      alert("手机号必填");
      return false;
    }
    if(!(/^1[34578]\d{9}$/.test(tel))){
      alert('请输入正确的手机号');
      $('#tel').focus();
      return false;
    }
    // if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(tel))){
    //     alert("请输入正确手机号");
    //     return false;
    // }
    if(cardid==""){
      alert("身份证必填");
      return false;
    }
    /*if(!(/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(cardid))){
     alert("身份证不正确 必填");
     return false;
     }*/
    // if(pic1 == "/Public/Home/Images/SeladdPic1.jpg"){
    //     alert("请上传身份证照片（正面）");
    //     return false;
    // }
    // if(pic2 == "/Public/Home/Images/SeladdPic1.jpg"){
    //     alert("请上传身份证照片（反面）");
    //     return false;
    // }
    if(pic1 == ''){
      alert("请上传身份证照片（正面）");
      return false;
    }
    if(pic2 == ''){
      alert("请上传身份证照片（反面）");
      return false;
    }

    if(display_pic== ""){
      alert("请上传个人图片!");
      return false;
    }

    if(zy_pic==""){
      alert("请上传主页图片!");
      return false;
    }
    if(province == "" || province == "请选择"){
      alert('请选择省份');
      return false;
    }
    if(city == '' || city=="请选择"){
      alert('请选择市');
      return false;
    }

    var len = $('#county_x').find('ul').find('li').length;
    if(len>1){
      if(district == '' || district=="请选择"){
        alert('请选择县');
        return false;
      }
    }

    //console.log(len);return false;
    if(address == ""){
      alert("详细地址必填");
      return false;
    }

    if(desc == ""){
      alert("个人简介必填!");
      return false;
    }

    $.ajax({
      url: "{:U('/Wxin/Shop/selIdentity')}",
      type: "post",
      dataType: "json",
      data: {
        name: name,
        tel:tel,
        cardID:cardid,
        address:address,
        pic1:pic1,
        pic2:pic2,
        province:province,
        city:city,
        district:district,
        zy_name:zy_name,
        zy_pic:zy_pic,
        logo_pic:display_pic,
        desc:desc,
        level:level
      }
    }).done(function (g) {
      if (g.status == 1) {
        alert(g.info);
        window.location.href="{:U('/Wxin/Shop/selAudit')}";
      } else {
        alert(g.info);
      }

    })

  })
</script>
</body>
</html>
