<include file="Public:head"/>
<style>
    .imgnav{
        max-height: 30px;
        overflow: hidden;
        cursor: pointer;
    }
    .imgwrapper{
        display: block;
        width: 78px;
        height: 78px;
        overflow: hidden;
    }
    .imgwrapper img{
        display: block;
        width: 100%;
        padding: 0;
        margin: 0;
        border:0;
    }
    .spanpd10{
        margin:10px;
    }
    .wxtables.wxtables-sku.newtable{
        width: 40%;
        margin: 0;
    }
    .img-list li{
        width: 60px;
        height:60px;
    }
    textarea {
        resize: both;
    }
    .cst_h3 span{font-weight: normal;}
    #imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
    .btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
    .file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
    #imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
    #xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
    #xuanze2:hover{ background:#E6E6E6; }
    .huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

    </style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>
<script type="text/javascript" src="__JS__/datepicker/WdatePicker.js"></script>
<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/>
    <!-- end content-left -->
    
    <div class="content-right fl">
      <h1 class="content-right-title">积分等级设置</h1>
      <form aciton="{:U('/Admin/integral/grade')}" enctype="multipart/form-data" method="post" id="add_step2" onsubmit="return toVaild()">
      <input type="hidden" name="id" value="{$cache['id']}">
        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">基本信息</h3>
            <table class="wxtables mgt10" style="text-align:center;">
                <colgroup>
                    <col width="25%">
                    <col width="25%">
                    <col width="25%">
                    <col width="25%">
                </colgroup>
                <thead>
                <tr class="po_list">
                    <td>等级名称</td>
                    <td>升级所需积分</td>
                    <td>获取积分比例(倍数)</td>
                    <td>消费抵扣比例(百分比)</td>
                </tr>
                </thead>
                <tbody>
                <volist name="grade" id="vo">
                    <tr>
                        <td><input type="text" name="title[]" class="input mini title" value="{$vo.title}"></td>
                        <td><input type="text" name="integral[]" class="input mini integral" value="{$vo.integral}"></td>
                        <td><input type="text" name="get_integral[]" class="input mini get_integral" value="{$vo.get_integral}"></td>
                        <td><input type="text" name="consumption_deduction[]" class="input mini consumption_deduction" value="{$vo.consumption_deduction}"></td>
                    </tr>
                </volist>
                </tbody>
            </table>
            
        <!-- end 详情及其它 -->
        <div class="panel-single panel-single-light mgt20 txtCenter"> 
          <a href="{:U('Admin/integral/grade')}" class="btn">取消</a>
          <a id="submit" class="btn btn-primary" >保存</a>
        </div>
      </form>
    </div>
    <!-- end content-right --> 
  </div>
</div>
<!-- end container --> 

<include file="Public:foot"/>

<script type="text/javascript" src="__JS__/jquery.js"></script> 
<script type="text/javascript" src="__JS__/uploadPreview.min.js"></script>
<script type="text/javascript">
   $(function () {
       $("#submit").click(function (){
           var post = {};
           var num = 0;
           var title = [];
           $(".title").each(function () {
              if ($(this).val().length == 0) {
                  alert("等级名称请填写完整");
                  $(this).focus();
                  num++;
                  return false;
              }
              title.push($(this).val());
           });
           if (num != 0) {
               return false;
           }
           var num1     = 0;
           var integral = [];
           $(".integral").each(function () {
               if ($(this).val().length == 0) {
                   alert("升级所需积分请填写完整");
                   $(this).focus();
                   num1++;
                   return false;
               }
               if (!/^[0-9]+(.[0-9]{2})?$/.test($(this).val())) {
                   alert("升级所需积分格式错误");
                   $(this).focus();
                   num1++;
                   return false;
               }
               integral.push($(this).val());
           });
           if (num1 != 0) {
               return false;
           }
           var num2         = 0;
           var get_integral = [];
           $(".get_integral").each(function () {
               if ($(this).val().length == 0) {
                   alert("获取积分比例请填写完整");
                   $(this).focus();
                   num2++;
                   return false;
               }
               if (!/^[0-9]+(.[0-9]{2})?$/.test($(this).val())) {
                   alert("获取积分比例格式错误");
                   $(this).focus();
                   num1++;
                   return false;
               }
               get_integral.push($(this).val());
           });
           if (num2 != 0) {
               return false;
           }
           var num3                     = 0;
           var consumption_deduction    = [];
           $(".consumption_deduction").each(function () {
               if ($(this).val().length == 0) {
                   alert("消费抵扣比例请填写完整");
                   $(this).focus();
                   num3++;
                   return false;
               }
               if (!/^[0-9]+(.[0-9]{2})?$/.test($(this).val())) {
                   alert("消费抵扣比例格式错误");
                   $(this).focus();
                   num1++;
                   return false;
               }
               consumption_deduction.push($(this).val());
           });
           if (num3 != 0) {
               return false;
           }
           post.title                   = title;
           post.integral                = integral;
           post.get_integral            = get_integral;
           post.consumption_deduction   = consumption_deduction;
           $.post("{:U('Admin/integral/grade')}", post, function (data){
               alert(data.info);
               location.reload();
           }, "json");
           return false;
       })
   });
</script>


