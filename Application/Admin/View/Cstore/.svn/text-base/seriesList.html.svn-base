<include file="Public:head"/>
<style>
  .btn-success {
    margin-top: 12px;
  }
</style>
<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/>
    <!-- end content-left -->

    <div class="content-right fl">
      <h1 class="content-right-title">分类列表</h1>
      <div class="alert alert-info disable-del">
        <h4>提示</h4>
        删除分类会删除分类下面所有的产品 <a href="javascript:;" class="alert-delete" title="隐藏"> <i class="gicon-remove"></i></a></div>
      <a href="javascript:;" class="btn btn-success fl BtnAddClass">添加分类</a><br><br><br><br>

      <form action="{:U('Admin/Cstore/seriesList')}" method="get">
        <div class="tables-searchbox newcearchbox">

          <input type="text" placeholder="分类名称" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" class="input" name="name" value="{$title}" >

          <button class="btn btn-primary" style="line-height:26px;"> <i class="gicon-search white"></i>查询 </button>

        </div>
      </form>
      <table class="wxtables mgt15 table-order" id="tb_3" style="text-align:center">
        <thead>
        <tr>
          <td>分类名称</td>
          <td>图片</td>
          <td>类型</td>
          <td>排序</td>
          <td >创建时间</td>
          <td class="center">操作</td>
        </tr>
        </thead>
        <tbody>
        <foreach name="cache" item="vo" >
          <tr>
            <td>{$vo.classname}</td>
            <td><a href="{$vo.pic}" target="_bank"><img src="{$vo.pic}" width="80" height="56" /></a></td>
            <td><if condition="$vo.cstores eq 0">艺术品<elseif condition="$vo.cstores eq 1"/>创意商店</if></td>
            <td>{$vo.sort}</td>
            <td>{$vo.create_at|date="Y-m-d H:i:s",###}</td>
            <td class="center"><a href="javascript:void(0);" class="btn btn-primary j-editClass" title="编辑" data-cstores="{$vo.cstores}" data-id="{$vo.id}" data-pic="{$vo.pic}"  data-wxin-title1="{$vo.wxin_title1}" data-wxin-title2="{$vo.wxin_title2}" data-title="{$vo.classname}" data-renk="{$vo.sort}">编辑</a> <a href="{:U('/Admin/Cstore/delSeries/id')}/{$vo.id}" class="btn btn-warning j-delClass" title="删除" onclick="return confirm('确定要删除吗？')" data-id="{$vo.id}">删除</a>
              <!-- <a href="javascript:;" class="btn btn-warning j-able" data-able="enable" title="禁用" data-id="9788">禁用</a>
                          --></td>
          </tr>

          <foreach name="vo.data" item="vo1" >
            <tr>
              <td class="center"><input type="checkbox" class="checkbox table-ckbs" data-id="9788"></td>
              <td>&nbsp;&nbsp;&nbsp;&nbsp;|-{$vo1.classname}</td>
              <td><img src="{$vo1.pic}" width="30" alt=""></td>
              <td>{$vo1.sort}</td>
              <td>{$vo1.create_at|date="Y-m-d H:i:s",###}</td>
              <td class="center">
                <a href="javascript:void(0);" class="btn btn-primary j-editClass" title="编辑" data-id="{$vo1.id}" data-pic="{$vo1.pic}" data-fid="{$vo1.pid}" data-title="{$vo1.classname}" data-renk="{$vo1.sort}">编辑</a>


                <a href="{:U('/Admin/Cstore/delSeries/id')}/{$vo1.id}" class="btn btn-warning j-delClass" title="删除" onclick="return confirm('确定要删除吗？')" data-id="{$vo1.id}">删除</a>
                <!-- <a href="javascript:;" class="btn btn-warning j-able" data-able="enable" title="禁用" data-id="9788">禁用</a>
                            --></td>
            </tr>
          </foreach>
        </foreach>
        </tbody>
      </table>
      <!-- end wxtables -->
      <div class="tables-btmctrl clearfix">
        <!--<a href="javascript;" class="btn btn-primary btn_table_delAll">批量删除</a></div>-->
        <div class="fr">
          <!--<div class="paginate">-->

          <div class="pages">
            <!--</div>-->
            {$page}
          </div>
          <!-- end paginate -->
        </div>
      </div>
      <!-- end tables-btmctrl -->
    </div>
    <!-- end content-right -->
  </div>
</div>
<!-- end container -->
<include file="Public:foot"/>





<div id="albums-overlay" class="disshow"></div>
<div class="jbox addfenlei disshow">
  <div class="jbox-title">
    <div class="jbox-title-txt">添加分类</div>
    <a href="javascript:;" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="height: 263px;">
    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>分类名称：</label>
      <div class="form-controls">
        <input type="text" class="input classname" name="classname" >
        <span class="sapnc"  style="color:red;"></span>
        <span class="fi-help-text"></span> </div>
    </div>
    <!-- <div class="formitems">
       <label class="fi-name"><span class="colorRed">*</span>类型：</label>
       <div class="form-controls">
         艺术品：<input type="radio" class="input classname" name="cstores" checked="checked" class="cstores" data-cstores='0' value="0" >
         创意商店：<input type="radio" class="input classname" name="cstores" class="cstores" data-cstores='1' value="1" >
         <span class="sapnc"  style="color:red;"></span>
         <span class="fi-help-text"></span> </div>
     </div>-->
    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>分类图片：</label>
      <div class="form-controls pdt5 j-imglistPanel">
        <div class="baotuan_showimge fl mgr10">
          <!--<img src="{$cache['index_pic']}" height="80">-->
        </div>
        <div class="btnimage fl">
          <input type="file"  accept="image/jpg,image/jpeg,image/png" name="baotuan" id="baotuan" class="file" >
        </div>
        <div class="baotuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="baotuan_percent">80%</span></div>

        <span class="sapnc1" style="color:red;"></span>
        <span class="fi-help-text fl lh30 mgl10">建议大小（宽230px高130px）</span>
      </div>
    </div>
   <!-- <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>分类图片：</label>
      <div class="form-controls pdt5 j-imglistPanel">
        <div class="showimgedit fl mgr10" style="margin-top:50px;">

        </div>
        <div class="btnimage fl">
          <input type="file"  accept="image/jpg,image/jpeg,image/png" name="editimage1" id="editimage1" class="file" >
        </div>
        <div class="progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="percent">80%</span></div>

        <span class="sapnc1" style="color:red;"></span>
        <span class="fi-help-text fl lh30 mgl10">建议大小（宽230px高130px）</span>
      </div>
    </div>-->
    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>分类排序：</label>
      <div class="form-controls">
        <input type="text" class="input" id="addsort" name="serial" >
        <span class="sapnc2" style="color:red;"></span>
        <span class="fi-help-text"></span> </div>
    </div>


  </div>
  <div class="jbox-buttons"><a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="addseriesgory">确定</a><a
          href="javascript:void (0);" class="jbox-buttons-ok btn cancle">取消</a></div>
</div>
<div class="jbox editfenlei disshow">
  <div class="jbox-title">
    <div class="jbox-title-txt">修改分类</div>
    <a href="javascript:;" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="height: 263px;">

    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>分类名称：</label>
      <div class="form-controls">
        <input type="text" class="input classname" name="classname" id="editclassname">
        <span class="fi-help-text"></span> </div>
    </div>

    <!--<div class="formitems">
        <label class="fi-name"><span class="colorRed">*</span>类型：</label>
        <div class="form-controls">
          艺术品：<input type="radio" class="input classname" name="cstores" class="cstores" data-cstores='0' value="0" >
          创意商店：<input type="radio" class="input classname" name="cstores" class="cstores" data-cstores='1' value="1" >
          <span class="sapnc"  style="color:red;"></span>
          <span class="fi-help-text"></span> </div>
      </div>-->

    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>分类图片：</label>
      <div class="form-controls pdt5 j-imglistPanel">
        <div class="showimgedit fl mgr10" style="margin-top:50px;">

        </div>
        <div class="btnimage fl">
          <input type="file"  accept="image/jpg,image/jpeg,image/png" name="editimage1" id="editimage1" class="file" >
        </div>
        <div class="progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="percent">80%</span></div>

        <span class="sapnc1" style="color:red;"></span>
        <span class="fi-help-text fl lh30 mgl10">建议大小（宽230px高130px）</span>
      </div>
    </div>

    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>分类排序：</label>
      <div class="form-controls">
        <input type="text" class="input sort" name="serial" id="editsort" >
        <input type="hidden" class="input sort" name="serial" id="seriesgoryid" >
        <span class="fi-help-text"></span> </div>
    </div>

  </div>
  <div class="jbox-buttons"><a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="editseriesgory">确定</a><a
          href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a></div>
</div>

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript">
    $(".cancle").click(function(){
        $(this).parent().parent('.jbox').hide();
        $('#albums-overlay').hide();
    })
    function delImg(obj){
        if(!confirm("删除这张图片？")){
            return false;
        }
        var id = $(obj).attr("data-id");
        if(id){
            $.post("{:U('Admin/Cstore/delGoodsSlide')}", {id:id}, function (data){
                if(data.status==1){
                    $(obj).remove();
                }else{
                    alert(data.info);
                }
            }, "json");
            return false;
        }
        $(obj).next("input").remove();
        $(obj).remove();
    }
    $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#addimage").wrap("<form id='myupload' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#addimage").change(function(){ //选择文件
            $("#myupload").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-53px;"><input type="hidden" name="pic" id="addpic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.showimg').html(img);
                    $("#addimage").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });


    $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#editimage1").wrap("<form id='myupload2' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#editimage1").change(function(){ //选择文件
            $("#myupload2").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-53px;"><input type="hidden" name="pic" id="editpic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.showimgedit').html(img);
                    $("#editimage").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });


        var percent = $('.baotuan_percent');
        var progress = $('.baotuan_percent');
        $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#baotuan").change(function(){ //选择文件
            $("#baotuan1").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" ><input type="hidden" name="index_pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.baotuan_showimge').html(img);
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });



</script>
<script>

</script>

<!--添加分类-->

<script type="text/javascript">
    $(".BtnAddClass").click(function(){
        $('.addfenlei').show();
        $('#albums-overlay').show();
    })
</script>
<script type="text/javascript">
    $("#addseriesgory").click(function(){
        var classname = $.trim($('.classname').val());  //分类名称
        var fid = $('#fid').val();
        var pic = $('#pic2').val();  //父分类id
        var sort = $('#addsort').val();           //排序
        var wxin_title1  = $.trim($("input[name=wxin_title1]").val());
        var wxin_title2  = $.trim($("input[name=wxin_title2]").val());

        //var cstores = $("input[name='cstores']:checked").data('cstores');

        if (classname == '') {
            alert("分类名称必填！");
            //$('.sapnc').text('分类名称必填！');
            return false;
        }
        $('.sapnc').text('');
        if (pic == undefined) {
            alert("图片不能为空！");
            //$('.sapnc1').text('图片不能为空！');
            return false;
        }
        $('.sapnc1').text('');
        if(!sort.match(/^[0-9]*$/)){
            alert("请填写正确的排序！");
            //$('.sapnc2').text('请填写正确的排序！');
            return false;
        }
        $('.sapnc2').text('');
        $.ajax({
            url: "{:U('/Admin/Cstore/addSeries')}",
            type: "post",
            dataType: "json",
            data: {
                classname:       classname,
                fid:       fid,
                pic:       pic,
                sort:      sort,
                wxin_title1 : wxin_title1,
                wxin_title2 : wxin_title2,
            }
        }).done(function (g) {
            if (g.status == 1) {
                alert(g.info);
                window.location.reload();
            } else {
                alert(g.info);
            }

        })
    })
</script>
<!--添加分类end-->

<!--修改分类-->
<script type="text/javascript">
    var seriesgoryid;
    $(".j-editClass").click(function(){
        $('.editfenlei').show();
        $('#albums-overlay').show();
        var seriesgoryname=$(this).attr('data-title');
        var seriesgoryid=$(this).attr('data-id');
        var fid=$(this).attr('data-fid');
        var pic=$(this).attr('data-pic');
        var sort=$(this).attr('data-renk');
        var wxin_title1=$(this).attr('data-wxin-title1');
        var wxin_title2=$(this).attr('data-wxin-title2');

        //var cstores = $(this).attr('data-cstores');
      /*if(cstores == 0 ){
       $("input[name='cstores'][value='0']").attr('checked',true); //1创意商店  0艺术品
       }else{

       $("input[name='cstores'][value='1']").attr('checked',true); //1创意商店  0艺术品
       }*/
        $('#editclassname').val(seriesgoryname);
        $('#editfid').val(fid);
        $('#editsort').val(sort);
        $('#seriesgoryid').val(seriesgoryid);
        $("input[name=wxin_title1]").val(wxin_title1);
        $("input[name=wxin_title2]").val(wxin_title2);
        if(pic!=""){

            var img = '<img src="'+pic+'" width="80" height="56" style="margin-top:-53px;"><input type="hidden" name="pic" id="editpic" value="'+pic+'"></input>';
            $('.showimgedit').html(img);

        }else{
            $('.showimgedit').html('');
        }




    })

    $("#editseriesgory").click(function(){
        var classname = $('#editclassname').val();  //分类名称
        var fid = $('#editfid').val();  //分类名称
        var pic = $('#editpic').val();
        var sort = $('#editsort').val();           //排序
        var seriesgoryid = $('#seriesgoryid').val();           //排序
        var wxin_title1=$("input[name=wxin_title1]").val();
        var wxin_title2=$("input[name=wxin_title2]").val();
        //var cstores = $("input[name='cstores']:checked").data('cstores'); //1创意商店  0艺术品

//alert(seriesgoryid);
        if (classname == '') {
            alert("分类名称必填！");
            return false;
        }
        $.ajax({
            url: "{:U('/Admin/Cstore/editSeries')}",
            type: "post",
            dataType: "json",
            data: {
                classname: classname,
                fid: fid,
                pic: pic,
                sort: sort,
                //cstores: cstores,
                seriesgoryid:seriesgoryid,
                wxin_title1:wxin_title1,
                wxin_title2:wxin_title2
            }
        }).done(function (g) {
            if (g.status == 1) {
                alert(g.info);
                window.location.reload();
            } else {
                alert(g.info);
            }

        })
    })
</script>
<!--修改分类end-->