<include file="Public:head"/>
<script src="__LAYDATE__/laydate.js"></script>
<style>
	.imgnav{
		max-height: 30px;
		overflow: hidden;
		cursor: pointer;
	}
	.imgwrapper{
		display: block;
		width: 78px;
		height: 78px;
		overflow: hidden;
	}
	.imgwrapper img{
		display: block;
		width: 100%;
		padding: 0;
		margin: 0;
		border:0;
	}
	.spanpd10{
		margin:10px;
	}
	.wxtables.wxtables-sku.newtable{
		width: 40%;
		margin: 0;
	}
	.img-list li{
		width: 60px;
		height:60px;
	}
	.cst_h3 span{font-weight: normal;}
	#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
	.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
	.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
	#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
	#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
	#xuanze2:hover{ background:#E6E6E6; }
	.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

	</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>
<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/> 
    <!-- end content-left -->
    
    <div class="content-right fl">
      <h1 class="content-right-title">编辑新闻</h1>
      <form aciton="{:U('/Admin/Goods/editNews')}" enctype="multipart/form-data" method="post" id="add_step2" onsubmit="return toVaild()">
      <input type="hidden" name="id" value="{$res['id']}">
        <!-- end 基本信息 -->
        
        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">新闻信息</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>标题：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" maxlength="30" name="title" id="title" value="{$res['title']}">
              <span class="fi-help-text"></span> </div>
          </div>

            <div class="formitems" >
                <label class="fi-name"><span class="colorRed">*</span>分类：</label>
                <div class="form-controls">
                    <select style="width: 150px;height: 30px;" name="cate" id="cate_id">
                        <volist name="news" id="v">
                            <option value="{$v.id}" <?php if(strpos($res['cate'],$v['id']) !== false){
                    echo selected;
                  }?>>{$v.name}</option>
                        </volist>
                    </select>
                    <span class="fi-help-text"></span>
                </div>
            </div>

            <div class="formitems" id="gallery" style="display:none">
                <label class="fi-name"><span class="colorRed">*</span>展览：</label>
                <div class="form-controls">
                    <select style="width: 150px;height: 30px;" name="display" id="disp">
                        <option value="0">无</option>
                        <volist name="display" id="vo">
                            <option value="{$vo.id}">{$vo.title}</option>
                        </volist>
                    </select>
                    <span class="fi-help-text"></span>
                </div>
            </div>

         <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>描述：</label>
            <div class="form-controls">
                <textarea class="input xxlarge" name="detail" maxlength="200" id="detail" style="width:420px;height: 100px;">{$res['detail']}</textarea>
              <span class="fi-help-text"></span> </div>
          </div>
            <div class="formitems">
                <label class="fi-name"><span class="colorRed">*</span>发布时间：</label>
                <div class="form-controls">
                    <input type="text" class="laydate-icon" name="addtime" id="addtime" value="{$res['addtime']|date='Y-m-d',###}">
                    <span class="fi-help-text"></span> </div>
            </div>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>作者：</label>
            <div class="form-controls">
              <input type="text" class="input" name="auth" maxlength="6" id="auth" value="{$res['auth']}">
              <span class="fi-help-text"></span> </div>
          </div>

            <div class="formitems">
                <label class="fi-name"><span class="colorRed">*</span>关键词：</label>
                <div class="form-controls">
                    <input type="text" class="input" name="keyword" maxlength="30" id="keyword" value="{$res['keyword']}">
                    <!--<span class="fi-help-text"></span> 多个关键词用逗号拼接</div>-->
            </div>
            </div>

            <div class="formitems">
                <label class="fi-name"><span class="colorRed"></span>排序：</label>
                <div class="form-controls">
                    <input type="text" class="input " name="sort" id="sort" value="{$res['sort']}">
                    <span class="fi-help-text"></span> </div>
            </div>

          <div class="formitems">

            <label class="fi-name"><span class="colorRed">*</span>新闻图片(小)：</label>

            <div class="form-controls pdt5 j-imglistPanel">
            <div class="xuanze_showimge fl mgr10">
            <img src="{$res['news_pic']}" height="80">
            </div>
            <div class="btnimage fl">选择图片
            <input type="file"  accept="image/jpg,image/jpeg,image/png" name="news_pic" id="xuanze" class="file" >
            </div>
            <div class="xuanze_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="xuanze_percent">80%</span></div>
            <span class="fi-help-text fl lh30 mgl10">建议大小（宽305px高204px）</span>
            </div>
     	  </div>

         <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>新闻详情页图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
              <div class="baotuan_showimge fl mgr10">
                <img src="{$res['pic']}" height="80">
              </div>
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="pic" id="baotuan" class="file" >
                </div>
                <div class="baotuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="baotuan_percent">80%</span></div>
                <span class="fi-help-text fl lh30 mgl10">建议大小（宽1920px高650px）</span>
            </div>
        </div>
          
        <!--<div class="formitems">-->
            <!--<label class="fi-name"><span class="colorRed">*</span>作品切换图片(多选)：</label>-->
            <!--<div class="form-controls pdt5 j-imglistPanel">-->
                <!--<div class="btnimage fl">选择图片-->
                    <!--<input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="duoxuan" class="file" >-->
                <!--</div>-->
                <!--<div class="duoxuan_progress fl mgr15" style="display:none">-->
                <!--<img src="__IMAGES__/loadings.gif" width="30" />-->
                <!--<span class="duoxuan_percent">80%</span></div>-->
                <!--<span class="fi-help-text fl lh30 mgl10">建议大小（宽1050px高1000px）点击图片删除</span>-->
                <!--<div style="clear:both"></div>-->
                <!--<div class="duoxuan_showimge mgr10">-->
                  <!--<foreach name="goods_slide" item="v">-->
                  <!--<img class="mgr10 mgt10" onclick="delImg(this)" data-id="{$v['id']}" src="{$v['pic']}" height="80">-->
                  <!--</foreach>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

		</div>
        
        <div class="panel-single panel-single-light mgt20 j-showinhyd" style="display: block;">
          <h3 class="cst_h3 mgb20">详情</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>新闻详情：</label>
            <div class="form-controls"> 
              <script id="editor" name="content" type="text/plain" style="width:730px;height:300px;">
                {$res['content']|htmlspecialchars_decode|stripslashes}
              </script>
            </div>
          </div>
        </div>

        <!-- end 详情及其它 -->
        <div class="panel-single panel-single-light mgt20 txtCenter"> 
          <a href="{:U('Admin/Goods/news')}" class="btn">取消</a>
          <input type="submit" class="btn btn-primary" value="保存">
        </div>
      </form>
    </div>
    <!-- end content-right --> 
  </div>
</div>
<!-- end container --> 

<include file="Public:foot"/>

                <link href="__UM__/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
                <script type="text/javascript" src="__UM__/third-party/jquery.min.js"></script>
                <script type="text/javascript" src="__UM__/third-party/template.min.js"></script>
                <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.config.js"></script>
                <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.min.js"></script>
                <script type="text/javascript" src="__UM__/lang/zh-cn/zh-cn.js"></script>



                <script>
                    $(document).ready(function(){
                        var show_id = "{$res['cate']}";
                        console.log(show_id);
                        if(show_id==2){
                            $("#gallery").show();
                            $("#disp option[value="+show_id+"]").attr('selected',true);
                        }
                        $("#cate_id").change(function () {
                            var cate = $("#cate_id").val();
                            console.log(cate);
                            if (cate == 2) {
                                $("#gallery").show();
                            } else {
                                $("#gallery").hide();
                            }

                        })
                    })

                </script>
<!--选择分类--> 
<script type="text/javascript">

  $('input[name=buylimit]').click(function(){
    if($(this).val()==3){
      $('input[name=recommend_g]').eq(1).attr('checked','checked');
      $('input[name=recommend_g]').eq(0).attr('disabled','disabled');
    }else{
      $('input[name=recommend_g]').eq(0).removeAttr('disabled','disabled');
    }
  });

  $("#j-select_category_id").click(function(){
      $('.select-fenlei').show();
      $('#albums-overlay').show();
  });
  $(".cancle").click(function(){
      $(this).parent().parent('.jbox').hide();
      $('#albums-overlay').hide();
  });

  $("#select_class").click(function(){
      var clssid=$("#select_class_id  option:selected").val();
      var classname=$("#select_class_id option:selected" ).text();
     $('#class_id').val(clssid);
     $('#class_name').val(classname);
      $(this).parent().parent('.jbox').hide();
      $('#albums-overlay').hide();
  });
			
			
	UM.getEditor('editor',{
		toolbars: [
	
      ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']
	
		],
	
		autoHeightEnabled: false,
		autoFloatEnabled: true,
		elementPathEnabled:false,
		enableContextMenu:false,
		wordCount:false,
	
	});

        $("#j-select_series_id").click(function(){
            $('.select-series').show();
            $('#albums-overlay1').show();
        });
        $(".cancle").click(function(){
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay1').hide();
        });

        $("#select_series").click(function(){
            var seriesid=$("#select_series_id  option:selected").val();
            var seriesname=$("#select_series_id option:selected" ).text();
            $('#series_id').val(seriesid);
            $('#series_name').val(seriesname);
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay1').hide();
        });


</script> 

<script type="text/javascript">
    function toVaild(){
        var title = $.trim($('#title').val());
        var detail = $.trim($('#detail').val());
        var addtime = $.trim($('#addtime').val());
        var auth = $.trim($('#auth').val());
        var cate_id = $("#cate_id").val();
        var show_id = $("#disp").val();
        if(cate_id == 2){
            if(show_id == 0){
                alert('请选择展览名！');
                return false;
            }
        }
        if(title==""){
            alert('标题不能为空');
            return false;
        }

        /*if(detail == ''){
            alert('描述不能为空');
            return false;
        }*/
        if(addtime == ''){
            alert('日期不能为空');
            return false;
        }
        if(auth == ''){
            alert('作者不能为空');
            return false;
        }

    }
</script> 
<!--提交表单前验证end--> 

<!--上传图片--> 

<!--<script type="text/javascript" src="__JS__/jquery.js"></script> -->
<script type="text/javascript" src="__JS__/uploadPreview.min.js"></script> 

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript">

  function delImg(obj){
    if(!confirm("删除这张图片？")){
      return false;
    }
    var id = $(obj).attr("data-id");
    if(id){
      $.post("{:U('Admin/Goods/delGoodsSlide')}", {id:id}, function (data){
        if(data.status==1){
          $(obj).remove();
        }else{
          alert(data.info);
        }
      }, "json");
      return false;
    }
    $(obj).next("input").remove();
    $(obj).remove();
  }
	$(function () { 
		var percent = $('.xuanze_percent'); 
		var progress = $('.xuanze_percent');
		$("#xuanze").wrap("<form id='myupload1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
		$("#xuanze").change(function(){ //选择文件 
			$("#myupload1").ajaxSubmit({ 
				dataType:  'json', //数据格式为json 
				beforeSend: function() { //开始上传 
					progress.show(); //显示进度条
					var percentVal = '0%';
					percent.html(percentVal);	
				}, 
				uploadProgress: function(event, position, total, percentComplete) { 
					var percentVal = percentComplete + '%'; //获得进度 
					percent.html(percentVal); //显示上传进度百分比 
				}, 
				success: function(data) { //成功 
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="news_pic" id="pic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					$('.xuanze_showimge').html(img);
					progress.hide();
				}, 
				error:function(xhr){ //上传失败 
					//console.log(xhr.status)
				} 
			}); 
		}); 

		
		var percent = $('.duoxuan_percent'); 
		var progress = $('.duoxuan_percent');
		$("#duoxuan").wrap("<form id='myupload' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
		$("#duoxuan").change(function(){ //选择文件 
			$("#myupload").ajaxSubmit({ 
				dataType:  'json', //数据格式为json 
				beforeSend: function() { //开始上传 
					progress.show(); //显示进度条
					var percentVal = '0%';
					percent.html(percentVal);	
				}, 
				uploadProgress: function(event, position, total, percentComplete) { 
					var percentVal = percentComplete + '%'; //获得进度 
					percent.html(percentVal); //显示上传进度百分比 
				}, 
				success: function(data) { //成功 
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80"  class="mgr10 mgt10 " onclick="delImg(this)"><input type="hidden" name="pic1[]" id="pic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					console.log(img);
					$('.duoxuan_showimge').append(img);
					progress.hide();
				}, 
				error:function(xhr){ //上传失败 
					//console.log(xhr.status)
				} 
			}); 
		}); 
		
		var percent = $('.baotuan_percent'); 
    var progress = $('.baotuan_percent');
    $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
    $("#baotuan").change(function(){ //选择文件 
      $("#baotuan1").ajaxSubmit({ 
        dataType:  'json', //数据格式为json 
        beforeSend: function() { //开始上传 
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal); 
        }, 
        uploadProgress: function(event, position, total, percentComplete) { 
          var percentVal = percentComplete + '%'; //获得进度 
          percent.html(percentVal); //显示上传进度百分比 
        }, 
        success: function(data) { //成功 
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
          $('.baotuan_showimge').html(img);
          progress.hide();
        }, 
        error:function(xhr){ //上传失败 
          //console.log(xhr.status)
        } 
      }); 
    }); 
		
	}); 
    function add_re(r){
        $('#restriction'+r).show();
        }
    function del_re(r){
        $('#restriction'+r).hide();
        }
</script>

                <script src="__LAYDATE__/laydate.js"></script>

                <script>
                    ;!function(){
                        laydate({
                            elem: '#addtime',
                            format: 'YYYY-MM-DD',
                        })

                    }();
                </script>
<script>
        ;!function(){
            laydate({
                elem: '#demo1',
                format: 'YYYY',
            })

        }();

        ;!function(){
            laydate({
                elem: '#demo',
                format: 'YYYY-MM-DD',
            })

        }();
</script>


