<include file="Public:head"/>
<script src="__LAYDATE__/laydate.js"></script>
<style>
	.imgnav{
		max-height: 30px;
		overflow: hidden;
		cursor: pointer;
	}
	.imgwrapper{
		display: block;
		width: 78px;
		height: 78px;
		overflow: hidden;
	}
	.imgwrapper img{
		display: block;
		width: 100%;
		padding: 0;
		margin: 0;
		border:0;
	}
	.spanpd10{
		margin:10px;
	}
	.wxtables.wxtables-sku.newtable{
		width: 40%;
		margin: 0;
	}
	.img-list li{
		width: 60px;
		height:60px;
	}
	.cst_h3 span{font-weight: normal;}
	#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
	.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
	.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
	#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
	#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
	#xuanze2:hover{ background:#E6E6E6; }
	.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

	</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>

<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/> 
    <!-- end content-left -->
    
    <div class="content-right fl">
      <h1 class="content-right-title">编辑作品</h1>
      <form action="{:U('/Admin/Goods/editThird')}" enctype="multipart/form-data" method="post" id="add_step2" onsubmit="return toVaild()">
      <input type="hidden" name="id" value="{$cache['id']}">
        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">基本信息</h3>
            <div class="formitems">
                <label class="fi-name"><span class="colorRed"></span>所属分类：</label>
                <div class="form-controls">
                    <a href="javascript:void(0)" class="btn btn-primary" id="j-select_series_id"> <i class="gicon-edit white"></i> 选择所属分类 </a>
                    <input type="text" value="{$cache['seriesname']}" id="series_name" style="border: 1px solid #fff;width: 500px;background-color:#fff;" disabled="">
                    <input type="hidden" value="{$cache['series_id']}" name="series_id" id="series_id"><input type="hidden" value="{$cache['cstore']}" name="cstore" id="cstore">
                    <span class="fi-help-text error"></span> </div>
            </div>
        </div>

        
        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">作品信息</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>标题：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" name="title" maxlength="21" id="title" value="{$cache['title']}">
              <span class="fi-help-text"></span> </div>
          </div>


          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>作者简介：</label>
            <div class="form-controls">
                <textarea class="input xxlarge" name="goods_cap" id="goods_cap" style="width:420px;height: 100px;">{$cache['goods_cap']}</textarea>
              <span class="fi-help-text"></span> </div>
          </div>

            <div class="formitems">
                <label class="fi-name"><span class="colorRed"></span>展览简介：</label>
                <div class="form-controls">
                    <textarea class="input xxlarge" name="detail" id="detail" style="width:420px;height: 100px;">{$cache['detail']}</textarea>
                    <span class="fi-help-text"></span> </div>
            </div>

        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>展览图片(多选)：</label>
            <div class="form-controls pdt5 j-imglistPanel">
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="duoxuan" class="file" >
                </div>
                <div class="duoxuan_progress fl mgr15" style="display:none">
                <img src="__IMAGES__/loadings.gif" width="30" />
                </div>
                <span class="fi-help-text fl lh30 mgl10"><span class="duoxuan_percent"></span>点击图片删除(首张图建议大小（宽1920px高650px）)</span>
                <div style="clear:both"></div>
                <div class="duoxuan_showimge mgr10">
                  <foreach name="goods_slide" item="v">
                  <img class="mgr10 mgt10" onclick="delImg(this)" data-id="{$v['id']}" src="{$v['pic']}" height="80">
                  </foreach>
                </div>
            </div>
        </div>

		</div>

        <!-- end 详情及其它 -->
        <div class="panel-single panel-single-light mgt20 txtCenter">

                <a href="{:U('Admin/Goods/third')}" class="btn">返回</a>

            <!--<a href="{:U('Admin/Goods/third')}" class="btn">取消</a>-->
                <input type="button" class="btn btn-primary" onclick="toVaild()" value="保存">


        </div>
      </form>
    </div>
    <!-- end content-right --> 
  </div>
</div>
<!-- end container --> 

<include file="Public:foot"/>
<div id="albums-overlay" style="display: none;"></div>
<div class="jbox fenlei select-fenlei disshow" >
  <div class="jbox-title">
    <div class="jbox-title-txt">请选择标签</div>
    <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="height: 75px;">
    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>选择标签：</label>
      <div class="form-controls">
        <select name="select_class_id" id="select_class_id" class="select">
          <foreach name="categorylist" item="vo" >
            <option disabled value="">{$vo.classname}</option>
          </foreach>
        </select>
        <span class="fi-help-text"></span> </div>
    </div>
  </div>
  <div class="jbox-buttons"> <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="select_class">确定</a> <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle">取消</a> </div>
</div>



<div class="jbox fenlei select-series disshow" >
    <div class="jbox-title">
        <div class="jbox-title-txt">请选择所属分类</div>
        <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
    <div class="jbox-container" style="height: 75px;">
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>选择分类：</label>
            <div class="form-controls">
                <select name="select_series_id" id="select_series_id" class="select">
                    <foreach name="serieslist" item="vo" >
                        <option value="{$vo.id}">{$vo.classname}</option>
                        <foreach name="vo.cate" item="vo1" >
                         <option value="{$vo1.id}">&nbsp;&nbsp;&nbsp;|-{$vo1.classname}</option>
                        </foreach> 
                  </foreach> 
           </select> 

           <!--      <div class="jbox-title-txt">请选择所属系列</div>
        <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
        <div class="jbox-container" style="height: 75px;">
          <div class="formitems">
              <label class="fi-name"><span class="colorRed"></span>选择系列分类：</label>
                <div class="form-controls">
                  <select name="cstore" id="select_cstore" class="select">
                        <option value="-1">请选择</option>
                        <option value="0">艺术品</option>
                        <option value="1">创意商店</option>
                      </select>
                      <span class="fi-help-text"></span> </div>
          </div>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>选择分类：</label>
            <div class="form-controls">
              <select name="series_id" id="select_series_id" class="select">
               
                      </select> -->
                <span class="fi-help-text"></span> </div>
        </div>
    </div>
    <div class="jbox-buttons"> <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="select_series">确定</a> <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle">取消</a> </div>
</div>






                <script>
                /*$("input[name=is_groom]").click(function () {
                    var is_groom = $("input[name=is_groom]:checked").val();
                    if (is_groom == 0) {
                        $('#chushou').hide()
                        $("#zujinbox").show();
                    } else {
                        $("#zujinbox").hide();
                        $("#chushou").show();
                    }

                })*/
                </script>
                <link href="__UM__/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
                <script type="text/javascript" src="__UM__/third-party/jquery.min.js"></script>
                <script type="text/javascript" src="__UM__/third-party/template.min.js"></script>
                <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.config.js"></script>
                <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.min.js"></script>
                <script type="text/javascript" src="__UM__/lang/zh-cn/zh-cn.js"></script>
<!--选择分类--> 
<script type="text/javascript">
 $('#select_cstore').change(function(){
     //alert($(this).val());
     var cstore_id = $(this).val();
     $.ajax({
        url:'/Admin/Goods/addGoodsy',
        type:'get',
        data:{cstore:cstore_id},
        dataType:'json',
        success:function(g){
          if(g.status == 1){
            console.log(g.info);
            var g = g.info;
            var option = "";//<option value="{$vo.id}">{$vo.classname}</option>
           $.each(g, function(i, n){
              console.log(n);
                option += '<option value="'+n.id+'">'+n.classname+'</option>';
             
          });
           console.log(option);
            $('#select_series_id').html(option);
          }
        }
     })
  })


                function num(obj){
                    obj.value = obj.value.replace(/[^\d.]/g,""); //清除"数字"和"."以外的字符
                    obj.value = obj.value.replace(/^\./g,""); //验证第一个字符是数字
                    obj.value = obj.value.replace(/\.{2,}/g,"."); //只保留第一个, 清除多余的
                    obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
                    obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); //只能输入两个小数
                }

		var dealer_id = $('#dealers_id').val();
		getstore(dealer_id);
		$('#dealers_id').change(function(){
			dealer_id = $(this).val();
			getstore(dealer_id);
		});
		
	
	function getstore(dealer_id){
		$.ajax({
			url:"{:U('Admin/Goods/ajax_getstore')}",
			type:'post',
			data:{'dealer_id':dealer_id},
			dataType:'json',
			success:function(ret){
				if(ret.result!=0){
					ret = ret.result;
					var str = '';
					console.log(ret);
					for(var val in ret){
						var val = ret[val];
						str += val.storename+' : <input type="text" class="input mini" name="stock[]" value="" >&nbsp;&nbsp;&nbsp;';
						str += '<input type="hidden" class="input mini" name="storeid[]" value="'+val.id+'" >';
					}
					$('#kucun').html(str);
				}
			}
		});
	}

  $('input[name=buylimit]').click(function(){
    if($(this).val()==3){
      $('input[name=recommend_g]').eq(1).attr('checked','checked');
      $('input[name=recommend_g]').eq(0).attr('disabled','disabled');
    }else{
      $('input[name=recommend_g]').eq(0).removeAttr('disabled','disabled');
    }
  });

  $("#j-select_category_id").click(function(){
      $('.select-fenlei').show();
      $('#albums-overlay').show();
  });
  $(".cancle").click(function(){
      $(this).parent().parent('.jbox').hide();
      $('#albums-overlay').hide();
  });

  $("#select_class").click(function(){
      var clssid=$("#select_class_id  option:selected").val();
      var classname=$("#select_class_id option:selected" ).text();
     $('#class_id').val(clssid);
     $('#class_name').val(classname);
      $(this).parent().parent('.jbox').hide();
      $('#albums-overlay').hide();
  });
			
			
	UM.getEditor('editor',{
		toolbars: [
	
      ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']
	
		],
	
		autoHeightEnabled: false,
		autoFloatEnabled: true,
		elementPathEnabled:false,
		enableContextMenu:false,
		wordCount:false,
	
	});

        $("#j-select_series_id").click(function(){

            $('.select-series').show();
            $('#albums-overlay').show();

            //var cstore = $('#cstore').val();
        });
        $(".cancle").click(function(){
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay').hide();
        });

        $("#select_series").click(function(){
            var seriesid=$("#select_series_id  option:selected").val();
            var seriesname=$("#select_series_id option:selected" ).text();
            var select_cstore = $("#select_cstore  option:selected").val();
            $('#series_id').val(seriesid);
            $('#series_name').val(seriesname);
            $('#cstore').val(select_cstore);
            $(this).parent().parent('.jbox').hide();
            $('#albums-overlay1').hide();
        });



			
		UM.getEditor('editor2',{
    toolbars: [
  
      ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']
  
    ],
  
    autoHeightEnabled: false,
    autoFloatEnabled: true,
    elementPathEnabled:false,
    enableContextMenu:false,
    wordCount:false,
  
  }); 
</script>
<script>
    function divClick(){
        var show= $('input:radio[name="is_pm"]:checked').val();

        switch (show){
            case '0':
                document.getElementById("pm").style.display="none";
                break;
            case '1':
                document.getElementById("pm").style.display="block";

                break;
        }
    }
</script>
<script type="text/javascript">
    var pm = '{$cache.is_pm}';
    if(pm == 1){
        document.getElementById('pm').style.display="block";
    }else{
        document.getElementById('pm').style.display="none";
    }
    function toVaild(){

        var series_name = $.trim($('#series_name').val());
        var title=$.trim($('#title').val());
        if(series_name==''||series_name==null){
            alert('所属分类必选');
            $('#series_name').focus();
            return false;
        }

        if(title==''||title==null){
            alert('标题必填');
            $('#title').focus();
            return false;
        }


        if(goods_cap==''||goods_cap==null){
            alert('作者简介必填');
            $('#goods_cap').focus();
            return false;
        }
        if(detail==''||detail==null){
            alert('展览简介必填');
            $('#detail').focus();
            return false;
        }



        $.ajax({
            url:'/Admin/Goods/editThird',
            type:'post',
            data:$("form").serialize(),
            dataType:'json',
            success:function(g){
                if(g.status == 1){
                    //alert();
                    //$('#add_step2').submit();
                    alert(g.info);
                    window.location.href="{:U('/Admin/Goods/third')}";
                    return false;
                    //dialog.showTips(g.info, "goodsList","{:U('/Admin/Goods/goodsList')}");
                }else{
                    alert(g.info);
                    return false;

                }

            }
        })
    }
</script> 
<!--提交表单前验证end--> 

<!--上传图片--> 

<!--<script type="text/javascript" src="__JS__/jquery.js"></script> -->
<script type="text/javascript" src="__JS__/uploadPreview.min.js"></script> 

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript">

  function delImg(obj){
    if(!confirm("删除这张图片？")){
      return false;
    }
    var id = $(obj).attr("data-id");
    //console.log(id);return false;
    if(id){
      $.post("{:U('Admin/Goods/delThirdSlide')}", {id:id}, function (data){
        if(data.status==1){
          $(obj).remove();
        }else{
          alert(data.info);
        }
      }, "json");
      return false;
    }
    $(obj).next("input").remove();
    $(obj).remove();
  }
	$(function () { 
		var percent1 = $('.xuanze_percent');
		var progress1 = $('.xuanze_percent');
		$("#xuanze").wrap("<form id='myupload1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
		$("#xuanze").change(function(){ //选择文件 
			$("#myupload1").ajaxSubmit({ 
				dataType:  'json', //数据格式为json 
				beforeSend: function() { //开始上传 
					progress1.show(); //显示进度条
					var percentVal = '0%';
					percent1.html(percentVal);
				}, 
				uploadProgress: function(event, position, total, percentComplete) { 
					var percentVal = percentComplete + '%'; //获得进度 
					percent1.html(percentVal); //显示上传进度百分比
				}, 
				success: function(data) { //成功 
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="logo_pic" id="pic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					$('.xuanze_showimge').html(img);
					progress1.hide();
				}, 
				error:function(xhr){ //上传失败 
					//console.log(xhr.status)
				} 
			}); 
		}); 

		
		var percent2 = $('.duoxuan_percent');
		var progress2 = $('.duoxuan_percent');
		$("#duoxuan").wrap("<form id='myupload' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
		$("#duoxuan").change(function(){ //选择文件 
			$("#myupload").ajaxSubmit({ 
				dataType:  'json', //数据格式为json 
				beforeSend: function() { //开始上传 
					progress2.show(); //显示进度条
					var percentVal = '0%';
					percent2.html(percentVal);
				}, 
				uploadProgress: function(event, position, total, percentComplete) { 
					var percentVal = percentComplete + '%'; //获得进度 
					percent2.html(percentVal); //显示上传进度百分比
				}, 
				success: function(data) { //成功 
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80"  class="mgr10 mgt10 " onclick="delImg(this)"><input type="hidden" name="pic1[]" id="pic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					console.log(img);
					$('.duoxuan_showimge').append(img);
					progress2.hide();
				}, 
				error:function(xhr){ //上传失败 
					//console.log(xhr.status)
				} 
			}); 
		}); 
		
		var percent3 = $('.baotuan_percent');
    var progress3 = $('.baotuan_percent');
    $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>"); 
    $("#baotuan").change(function(){ //选择文件 
      $("#baotuan1").ajaxSubmit({ 
        dataType:  'json', //数据格式为json 
        beforeSend: function() { //开始上传 
          progress3.show(); //显示进度条
          var percentVal = '0%';
          percent3.html(percentVal);
        }, 
        uploadProgress: function(event, position, total, percentComplete) { 
          var percentVal = percentComplete + '%'; //获得进度 
          percent3.html(percentVal); //显示上传进度百分比
        }, 
        success: function(data) { //成功 
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="index_pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
          $('.baotuan_showimge').html(img);
          progress3.hide();
        }, 
        error:function(xhr){ //上传失败 
          //console.log(xhr.status)
        } 
      }); 
    }); 
		
	}); 
    function add_re(r){
        $('#restriction'+r).show();
        }
    function del_re(r){
        $('#restriction'+r).hide();
        }
</script>
<script>
        ;!function(){
            laydate({
                elem: '#demo1',
                format: 'YYYY',
            })

        }();

        ;!function(){
            laydate({
                elem: '#demo',
                format: 'YYYY-MM-DD',
            })

        }();

        ;!function(){
            laydate({
                elem: '#demo2',
                format: 'YYYY-MM-DD hh:mm:ss',
            })

        }();

        ;!function(){
            laydate({
                elem: '#demo3',
                format: 'YYYY-MM-DD hh:mm:ss',
            })

        }();
</script>


