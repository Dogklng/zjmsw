<include file="Public:head"/>

<style>
    .ftnormal {line-height: 25px!important;}
    .btn{vertical-align: baseline;}
    .newinput{ width:145px;}
    .select.mini{width: 110px;}
    .vtal-2{vertical-align: -2px;}
	.shady{ background:#000; opacity:0.5; width:100%; height:100%; position:fixed; top:0; left:0; z-index:111111; display:none; }
    .make1 {
        display: inline-block;
        width: 40px;
        float: left;
    }
    .amw {
        float: left;
    }
</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>

<script type="text/javascript">

    J(function(){
        J('#starttime').calendar();
        J('#endtime').calendar();
//    $(function(){
//        $('#starttime').calendar({ format:'yyyy-MM-dd' });
//        $('#endtime').calendar({ format:'yyyy-MM-dd' });
    });

</script>

<div class="container">
<div class="inner clearfix" style="width:1360px;">
    <include file="Public:left"/>
<!-- end content-left -->
<div class="shady" id="heemu"></div>
<img src="" id="em" style="position:fixed;width:34%;margin:auto;left:0;right:0;display:none;z-index:11111111111111;cursor:pointer;" onclick="this.style.display='none',document.getElementById('heemu').style.display='none'"/>
<div class="content-right fl">


    <h1 class="content-right-title">推荐订单明细列表</h1>


    <!--<form action="{:U('Admin/Contractaudit/audit')}" method="post">
        <div class="tables-searchbox">
            <input type="text" placeholder="手机号" class="input newinput" name="telephone" value="{$telephone}">
            <input type="text" placeholder="用户姓名" class="input newinput" name="person_name" value="{$person_name}">
            <input type="text" placeholder="输入合同号" class="input newinput" name="order_no" value="{$order_no}">
            <button class="btn btn-primary vtal-2"><i class="gicon-search white"></i>查询</button>
        </div>
    </form>-->
    <!--<a href="{:U('Admin/Contractmanage/wordfile')}" target="_blank"><button class="btn btn-success " style="float: right;">导出</button></a>-->
    <a href="javascript:history.back(-1)" style="float:right;background-color: #00B01D;" class="btn">返回</a>
    <div class="tabs clearfix mgt15">
        <table class="wxtables table-order mgt20" style="width:117%;" id="tb_3">
            <thead>
            <tr>
                <td align="center">下单人信息</td>
                <td align="center">订单金额</td>
                <td align="center">实际支付</td>
                <td align="center">支付时间</td>
                <td align="center">支付类型</td>
                <eq name="type" value="1">
                    <td align="center">推荐佣金</td>
                    <else/>
                    <td align="center">店铺金额</td>
                </eq>
                <td align="center">订单状态</td>
              <!--  <td align="center">推荐人</td>-->
            </tr>
            </thead>
            <tbody>
            <volist name="cache" id="vo" empty="$empty">

                <tr>
                    <td colspan="13" class="ftnormal" style="background-color:#F2F8FC;">
                        <span>订单编号：<b>{$vo.order_no}</b></span>
                        <span class="mgl15">{$vo.order_time|date="Y-m-d H:i:s",###}</span>
                    </td>
                </tr>
                <tr>
                    <td valign="top" class="txtCenter" style="padding-top:15px;vertical-align: inherit;">
                        <p><span class="make1">姓名：</span><span class="amw">{$vo.realname}</span></p><br/>
                        <p><span class="make1">电话：</span><span class="amw">{$vo.telephone}</span></p><br/>
                    </td>

                    <td valign="top" class="txtCenter" style="padding-top:15px;vertical-align: inherit;">
                        <p><b>¥<if condition="$vo['total_price']">{$vo.total_price}<else />0.00</if></b></p>
                    </td>


                    <td valign="middle" align="center" class="txtCenter">
                        <p><b>¥<if condition="$vo['pay_price']">{$vo.pay_price}<else />0.00</if></b></p>
                    </td>
                    <td valign="middle" align="center"  class="txtCenter">
                        <notempty name="vo['pay_time']">
                            <p><b>{$vo.pay_time|date="Y-m-d H:i:s",###}</b></p>
                        </notempty>
                    </td>

                    <!-- 0待接受 1 申请中 2 任务开始 3任务完成  4确认任务完成 5 取消任务 6退款 7任务结束 -->
                    <td valign="middle" align="center"  class="txtCenter">
                        <p><b>
                            <switch name="vo.pay_way">
                                <case value="1">支付宝</case>
                                <case value="2">微信支付</case>
                                <case value="3">银联</case>
                                <case value="4">余额</case>
                            </switch>
                        </b></p>
                    </td>

                    <td valign="top" class="txtCenter" style="padding-top:15px;vertical-align: inherit;">
                        <eq name="type" value="1">
                            <p><b>¥{$vo.yong_tee}</b></p>
                            <else/>
                            <p><b>¥{$vo.sub_tree}</b></p>
                        </eq>
                    </td>

                    <td valign="middle" align="center"  class="txtCenter">
                        <p>
                            <switch name="vo.order_status">
                                <case value="0">已取消</case>
                                <case value="1">待付款</case>
                                <case value="2">待发货</case>
                                <case value="3">待收货</case>
                                <case value="4">已签收</case>
                                <case value="5">已关闭</case>
                                <case value="6">退款中</case>
                            </switch>
                        </p>
                    </td>
                </tr>
            </volist>
            </tbody>
        </table>



        <!-- end wxtables -->
        <div class="tables-btmctrl clearfix mgt10">
            <div class="fl" style="float:none;">
                <!-- <a href="javascript:;" class="btn btn-primary btn_table_selectAll">全选</a>
                <a href="javascript:;" class="btn btn-primary btn_table_Cancle">取消</a> -->
                <!-- <a href="javascript:void(0)" onclick="del()" class="btn btn-danger J_batch_del">删除订单</a> -->
            </div>

            <div class="pages" style="float:none;width:100%;text-align:center;padding-top:10px;">
                {$page}
            </div>
                <!-- end paginate -->

        </div>        <!-- end tables-btmctrl -->


    <form action="" method="post" id="ids">
        <input type="hidden" name="ids" value="">
    </form>


</div>
<!-- end content-right -->
</div>
</div>
<!-- end container -->
<include file="Public:foot"/>
<div id="albums-overlay" class="disshow"></div>
<div class="jbox editfenlei disshow quxiao" style="height:255px;">
  <div class="jbox-title">
    <div class="jbox-title-txt">发货信息</div>
    <a href="javascript:;" class="jbox-close cancle"></a></div>
  <div class="jbox-container">

    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>快递公司：</label>
      <div class="form-controls">

        <select name="express_name" id="">
        <foreach name="express_list" item="vo">
            <option value="{$vo['express_ma']}">{$vo['express_company']}</option>
            </foreach>
        </select>

        <span class="fi-help-text"></span> </div>
    </div>
      <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>快递单号：</label>
          <div class="form-controls">
<input type="text" onKeyUp="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" class="input describe1" name="express_no">
              <span class="fi-help-text"></span> </div>
      </div>
      <!-- <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>快递价格：</label>
          <div class="form-controls">
              <input type="text" class="input describe2" name="express_fee">
              <span class="fi-help-text"></span> </div>
      </div> -->
      <div class="jbox-buttons" style="text-align:center;">
      <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="fahuo">确定发货</a>
      <a href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a>
      </div>
</div>
</div>


<!-- //退款 -->
<div class="jbox tuikuan disshow quxiao" style="height:350px;">
  <div class="jbox-title">
    <div class="jbox-title-txt">退款信息</div>
    <a href="javascript:;" class="jbox-close cancle"></a>
	</div>
  <div class="jbox-container">

    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>订单编号：</label>
      <div class="form-controls">
      	<input type="text" value=""  class="input order_no" name="order_no" style="width:200px" readonly>
        <span class="fi-help-text"></span> </div>
    </div>
    
	 <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>订单支付积分：</label>
      <div class="form-controls">
		<input type="text" value=""  class="input pay_integral" name="pay_integral" readonly style="color:red">
          <span class="fi-help-text"></span> </div>
  </div>
  
  <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>订单支付金额：</label>
      <div class="form-controls">
		<input type="text" value=""  class="input total_fee" name="total_fee" readonly style="color:red">
          <span class="fi-help-text"></span> </div>
  </div>
  
 
  
  <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>退还积分：</label>
      <div class="form-controls">
		<input type="text" value=""  class="input refund_realintegral" name="refund_realintegral">
          <span class="fi-help-text"></span> </div>
  </div>
  
  <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>订单金额：</label>
      <div class="form-controls">
		<input type="text" value=""  class="input refund_fee" name="refund_fee" >
          <span class="fi-help-text"></span> </div>
  </div>

  
  
  
  <div class="jbox-buttons" style="text-align:center;">
  <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="con_tuikuan">确定退款</a>
  <a href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a>
  </div>
</div>
</div>




<!--gonggao-->
<script>

$(".daochu").click(function(){
	
$.ajax({
            url:"{:U('Admin/Order/orderExport')}",
            type:'post',
            datatype : 'json',
            success:function(data){
                if(data.status==1){
                    alert(data.info);
                    location.href="{:U('Admin/Order/index')}";
                }else{
                    alert(data.info);
                }
            }
        });
})





</script>
    <script type="text/javascript">
        $(".new-contract").click(function(){
            if(!confirm("此操作不可逆，确定通过审核吗？")){
                return false;
            }
            var contract_id = $(this).attr('data-id');
            $.ajax({
                url:"{:U('Admin/Contractaudit/audit')}",
                type:'post',
                data :{id:contract_id},
                datatype : 'json',
                success:function(data){
                    if(data.status==1){
                        alert(data.info);
                        location.href="{:U('Admin/Contractaudit/audit')}";
                    }else{
                        alert(data.info);
                    }
                }
            });
        });
    </script>
    <!--修改分类-->
<script type="text/javascript">
 $(".cancle").click(function(){
        $(this).parent().parent('.jbox').hide();
        $('#albums-overlay').hide();
        $(".quxiao").hide();
    })
 var id ='';
 $(".j-editClass").click(function(){
        id = $(this).attr("data-id");
        $('.editfenlei').show();
        $('#albums-overlay').show();
});

 $("#fahuo").click(function(){
     var data = {};
        data.express_name    = $.trim($("select[name=express_name]").val());
        // data.express_fee     = $.trim($("input[name=express_fee]").val());
        data.express_no         = $.trim($("input[name=express_no]").val());
        if(!data.express_name){
            alert("请选择物流公司！");return false;
        }
        if(!data.express_no){
            alert("请填写快递单号！");return false;
        }
        data.id = id ;
        $.ajax({
            url:"{:U('Admin/Order/express')}",
            type:'post',
            data :data,
            datatype : 'json',
            success:function(data){
                if(data.status==1){
                    alert(data.info);
                    location.href="{:U('Admin/Order/index')}";
                }else{
                    alert(data.info);
                }
            }
        });
 });

 $(".j-tuikuan").click(function(){

        //id = $(this).attr("data-id");
        $('.tuikuan').show();
        $('#albums-overlay').show();
		var order_no  = $(this).attr('data-order-no');
		var total_fee = $(this).attr('data-order-totalfee');
		var pay_integral =$(this).attr('data-pay_integral');
		
		$('.order_no').val(order_no);
		$('.pay_integral').val(pay_integral);
		$('.total_fee').val(total_fee);
		
		$('.refund_realintegral').val(pay_integral);
		$('.refund_fee').val(total_fee);
		
});

 $("#con_tuikuan").click(function(){
     var data = {};
		data.order_no             = $('.order_no').val();
		data.pay_integral         = $.trim($("input[name=pay_integral]").val());
        data.total_fee            = $.trim($("input[name=total_fee]").val());
        data.refund_realintegral  = $.trim($("input[name=refund_realintegral]").val());
		data.refund_fee           = $.trim($("input[name=refund_fee]").val());
       console.log(data);
        if(!data.refund_fee){
            alert("请填写退款金额！");return false;
        }else if(data.refund_fee > data.total_fee){
			alert("退款金额应小于等于订单金额！");return false;
		}
		 if(!data.refund_fee){
            alert("请填写退还积分！");return false;
        }else if(data.refund_realintegral > data.pay_integral){
			alert("退还积分应小于等于购物返的积分！");return false;
		}
		
        $.ajax({
            url:"{:U('Admin/Order/refundcs')}",
            type:'post',
            data :data,
            datatype : 'json',
            success:function(data){
                if(data.status==1){
                    alert(data.info);
                    location.href="{:U('Admin/Order/index')}";
                }else{
                    alert(data.info);
                }
            }
        });
 });





</script>