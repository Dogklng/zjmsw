<include file="Public:header" />

<!--  / warpper  -->
<style>
  .user8_con2 p span {
    display: inline-block;
    font-size: 13px;
    color: #666;
    letter-spacing: 1px;
    width: 90px;
    float: left;
    line-height: 30px;
    padding-right: 5px;
  }
  .classic {
    width: 30%;
    border: 1px solid #e8e8e8;
    border-top: none;
    border-bottom: none;
    margin-left: 90px;
    margin-bottom: 15px;
    display: none;
  }
</style>
<script type="text/javascript" src="__JS__/jquery.js"></script>
<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<div class="warpper wrapper1" style="margin: 150px auto 80px;"> 
  
  <!--  / user  -->
  <div class="user">
    <div class="">
      <div class="row">
        <div class="col-sm-2">
          <include file="Public:user_left" />
        </div>
        <div class="col-sm-10">
          <div class="user_r6">
            <div class="user_r6a">
              <h2>投稿</h2>
            </div>
            <form class="user8_con2">
              <!--<div class="fenlei">
                <p><span><b style="color: red">*</b>分类：</span>
                  <label class="classic_txt"></label>
                  <input type="hidden" name="cate" value="1" >
                </p>
                <ul class="classic" style="left: 200px">
                    <volist name="news" id="v">
                      <li><a href="javascript:;" data-value="{$v.id}">{$v.name}</a></li>
                    </volist>
                  &lt;!&ndash;<li><a href="javascript:;">艺术头条</a></li>
                  <li><a href="javascript:;">展览资讯</a></li>
                  <li><a href="javascript:;">艺术头条</a></li>&ndash;&gt;
                </ul>
              </div>-->
              <input type="hidden" name="cate" value="1" >
              <input type="hidden" name="id" value="{$info.id}" >
              <p><span><b style="color: red">*</b>标题：</span>
                <input type="text" value="{$info.title}" maxlength="30" name="title" style="width:90%;">
              </p>
              <p><span><b style="color: red">*</b>描述：</span>
                <textarea name="detail" maxlength="200" cols="30" rows="2" style="width:90%;border-color: #e8e8e8;">{$info.detail}</textarea>
              </p>
              <p><span><b style="color: red">*</b>发布时间：</span>
                <input type="text" value="{$info.addtime|date='Y-m-d',###}" maxlength="30" readonly id="addtime" name="addtime" style="width:90%;">
              </p>
              <p><span><b style="color: red">*</b>作者：</span>
                <input type="text" value="{$info.auth}" maxlength="30" name="auth" style="width:90%;">
              </p>
              <p><span><b style="color: red">*</b>新闻详情：</span>
                <textarea name="content" cols="30" rows="5" style="width:90%;border-color: #e8e8e8;">{$info.content|htmlspecialchars_decode|stripslashes}</textarea>
              </p>
              <p><span><b style="color: red">*</b>关键词：</span>
                <input type="text" value="{$info.keyword}" name="keyword" maxlength="30" style="width:90%;">
              </p>

              <p class="add_pic_box"><span style="width:130px;"><b style="color: red">*</b>新闻图片(小)：</span>
                  <img class="xuanze_showimge" src="{$info.news_pic}" width="120">
                <input class="add_pic" name="xuanze" id="xuanze1" type="file" />
                <input type="hidden" name="news_pic" id="news_pic" value="{$info.news_pic}">

                <b class="saomiao" style="left: 300px">建议大小（宽305px 高204px）</b><b class="saomiao xuanze_percent" style="display: none;left: 260px;">80%</b></p>

              <p><span style="width:130px;"><b style="color: red">*</b>新闻详情页图片：</span>
               <img class="baotuan_showimge" src="{$info.pic}" width="120">
                <input class="add_pic" name="baotuan" id="baotuan" type="file" />
                <input type="hidden" name="pic" id="pic" value="{$info.pic}">
                <b class="saomiao" style="left: 300px">建议大小（宽1920px 高650px）</b><b class="saomiao baotuan_percent" style="display: none;left: 260px;">80%</b></p>
              <div class="user_r6_line"></div>
              <a href="javascript:;" onclick="toVaild()">提交</a>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!--  / user  -->
  
</div>
<!--  / warpper  -->

<include file="Public:footer" />
<script type="text/javascript" src="__JS__/jeDate/jedate.js"></script>
</body>
<script>
    function toVaild(){
        var cate = $('input[name="cate"]').val();
        var title = $.trim($('input[name="title"]').val());
        var detail = $.trim($('textarea[name="detail"]').val());
        var addtime = $.trim($('#addtime').val());
        var auth = $.trim($('input[name="auth"]').val());
        var keyword = $.trim($('input[name="keyword"]').val());
        var news_pic = $('input[name="news_pic"]').val();
        var pic = $('input[name="pic"]').val();
        var content = $.trim($('textarea[name="content"]').val());

        if(cate==""){
            alert('请选择分类');
            return false;
        }

        if(title==""){
            alert('请填写标题');
            return false;
        }

        if(detail == ''){
            alert('描述不能为空');
            return false;
        }
        if(addtime == ''){
            alert('请选择发布时间');
            return false;
        }
        if(auth == ''){
            alert('请填写作者');
            return false;
        }
        if(content == ''){
            alert('请填写新闻详情');
            return false;
        }

        if(keyword == ''){
            alert('请填写关键词');
            return false;
        }
        if(news_pic ==''){
            alert('请上传新闻图片(小)');
            return false;
        }
        if(pic == ''){
            alert('请上传新闻详情页图片');
            return false;
        }

        $.ajax({
            url:'/Home/PersonalCenter/edituser_vote',
            type:'post',
            data:$("form").serialize(),
            dataType:'json',
            async: false,
            success:function(g){
                if(g.status == 1){
                    dialog.showTips(g.info, "","{:U('/Home/PersonalCenter/newlist/tag/newlist/value/8')}");
                }else{
                    alert(g.info);
                    return false;

                }

            }
        })

        return false;

    }
    $(function () {
        var percent1 = $('.xuanze_percent');
        var progress1 = $('.xuanze_percent');
        $("#xuanze1").wrap("<form id='myupload2' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#xuanze1").change(function () { //选择文件
            $("#myupload2").ajaxSubmit({
                dataType: 'json', //数据格式为json
                beforeSend: function () { //开始上传
                    progress1.show(); //显示进度条
                    var percentVal = '0%';
                    percent1.html(percentVal);
                },
                uploadProgress: function (event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    percent1.html(percentVal); //显示上传进度百分比
                },
                success: function (data) { //成功
                    //console.log(data);
                    //var img = '<img src="' + data[0]["savepath"].substr(1) + data[0]["savename"] + '" height="80" ><input type="hidden" name="news_pic" id="pic" value="' + data[0]["savepath"].substr(1) + data[0]["savename"] + '"></input>';
                    //$('.xuanze_showimge').html(img);
                    var img = data[0]["savepath"].substr(1)+data[0]["savename"];
                    $('.xuanze_showimge').attr('src',img);
                    $('input[name="news_pic"]').val(img);
                    progress1.hide();
                },
                error: function (xhr) { //上传失败
                    //console.log(xhr.status)
                }
            });
        });

        var percent = $('.baotuan_percent');
        var progress = $('.baotuan_percent');
        $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#baotuan").change(function(){ //选择文件
            $("#baotuan1").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    //console.log(data);
                    var img = data[0]["savepath"].substr(1)+data[0]["savename"];
                    //$('.baotuan_showimge').html(img);
                    $('.baotuan_showimge').attr('src',img);
                    $('input[name="pic"]').val(img);
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });
$(".fenlei p label").click(function(){
  $(".classic").slideToggle(500);
})
$(".classic li").click(function(){
  $(".classic").slideToggle(500);
  $(".fenlei p label").text($(this).find('a').text());
  $(".fenlei p label").attr('data-value',$(this).find('a').attr('data-value'));
  $('input[name="cate"]').val($(this).find('a').attr('data-value'));
})
    jeDate({
        dateCell:"#addtime",
        format:"YYYY-MM-DD",
        isinitVal:false,
        isClear:false,
        //minDate:"2014-09-19 00:00:00",
        okfun:function(val){alert(val)}
    })
</script>

</html>
