<include file="Public:head"/>
<style>
    #addimage1 {
        width: 80px;
        height: 56px;
        padding: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        z-index: 10;
        cursor: pointer;
        opacity: 0;
    }
    .formitems #editimage1 {
        width: 80px;
        height: 56px;
        padding: 0px;
        position: absolute;
        top: 0px;
        left: 0px;
        z-index: 10;
        cursor: pointer;
        opacity: 0;
    }
</style>
<div class="container">
    <div class="inner clearfix">
        <include file="Public:left"/>
        <!-- end content-left -->

        <div class="content-right fl">
            <h1 class="content-right-title">图片列表</h1>

            <form action="" method="get">
                <div class="clearfix"> <a href="javascript:;" class="btn btn-success fl BtnAddClass">添加广告</a>

                    <div class="tables-searchbox fr">
                        <select name="type" class="select">
                            <option value="">------------所 有------------</option>
                            <volist name="bannertypelist" id="v"> 
                                <option value="{$v.id}" <eq name="type" value="$v['id']">selected</eq> >{$v.classname}</option>
                            </volist>
                        </select>

                        <!-- <input type="text" placeholder="分类名称" class="input" name="class_name" value="{$name}"> -->

                        <button class="btn"><i class="gicon-search"></i>查询</button>
                    </div>
                </div>
            </form>

            <div class="alert alert-info disable-del">共有 <span style="font-size:16px;">{$count}</span> 张图片。<a href="javascript:;" class="alert-delete" title="隐藏"><i class="gicon-remove"></i></a></div>
            <div class="tablesWrap">

                <!-- end tables-searchbox -->
                <table class="wxtables table-order">
                    <colgroup>
                        <col width="10%">
                        <col width="20%">
                        <col width="20%">
                        <col width="10%">
                        <col width="10%">
                        <col width="10%">
                        <col width="20%">
                    </colgroup>
                    <thead>
                    <tr>
                        <td>图片分类</td>
                        <td>PC端图片</td>
                        <td>手机端图片</td>
                        <td>图片链接</td>
                        <td>图片大标题</td>
                        <td>图片小标题</td>
                        <td align="center">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    <foreach name="piclist" item="vo">
                        <tr>
                            <td>
                                {$vo.classname}
                            </td>
                            <td>
                                <empty name="vo.pic">
                                    暂未上传
                                <else/>
                                    <img src="{$vo.pic}" width="100%" height="50px" />
                                </empty>
                            </td>
                            <td>
                                 <empty name="vo.tel_pic">
                                    暂未上传
                                <else/>
                                    <img src="{$vo.tel_pic}" width="100%" height="50px" />
                                </empty>
                            </td>
                            <td>{$vo.url}<br />{$vo.tel_url}</td>
                            <td>{$vo.title}</td>
                            <td>{$vo.title1}</td>
                            <td align="right"><p style=" text-align:center">
                                <a class="btn btn-primary j-editClass" data-tel-pic="{$vo.tel_pic}" data-tel_url="{$vo.tel_url}" data-content="{$vo.content}" data-url="{$vo.url}" data-title="{$vo.title}" data-title1="{$vo.title1}" data-id="{$vo.id}" data-type="{$vo.type}" data-pic="{$vo.pic}">编辑</a>
                                <a href="javascript:void();" class="btn btn-warning j-delClass" title="删除"  data-id="{$vo.id}">删除</a>
                            </td>

                        </tr>
                    </foreach>
                    </tbody>
                </table>
                <!-- end wxtables -->
                <div class="tables-btmctrl clearfix">
                    <div class="fl">
                        <!--<a href="javascript:;"  style="background-color:#f0ad4e;border-color:#eea236;"  class="btn btn-primary del">删除</a>-->
                    </div>
                    <div class="fr">
                        <div class="pages">
                            {$page}
                        </div>
                        <!-- end paginate -->
                    </div>
                </div>
                <!-- end tables-btmctrl -->
            </div>
            <!-- end tablesWrap -->

        </div>
        <!-- end content-right -->
    </div>
</div>
<!-- end container -->
<include file="Public:foot"/>


<div id="albums-overlay" class="disshow"></div>
<div class="jbox addfenlei disshow">
    <div class="jbox-title">
        <div class="jbox-title-txt">添加广告</div>
        <a href="javascript:void(0)" class="jbox-close cancle"></a></div>
    <div class="jbox-container" style="height: 263px;">

        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>图片分类：</label>
            <div class="form-controls">
                <select name='type' style='padding:5px;border: 1px solid #ccc;width:182px' id='editfid'>
                    <option value="">--请选择--</option>
                    <foreach name="bannertypelist" item="vo" >
                        <option value="{$vo.id}">{$vo.classname}</option>
                    </foreach>
                </select>
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片链接：</label>
            <div class="form-controls">
                <input type="text"  class="input url">
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片手机端链接：</label>
            <div class="form-controls">
                <input type="text"  class="input tel_url">
                <span class="fi-help-text"></span> </div>
        </div>

        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片大标题：</label>
            <div class="form-controls">
                <input type="text"  class="input title">
                <span class="fi-help-text"></span> </div>
        </div>

        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片小标题：</label>
            <div class="form-controls">
                <input type="text"  class="input title1">
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>内容：</label>
            <div class="form-controls">
                <input type="text"  class="input content">
                <span class="fi-help-text"></span> </div>
        </div>

        <div class="formitems" style=" height:60px;">
            <label class="fi-name"><span class="colorRed">*</span>PC端图片：</label>
            <div class="form-controls images">
                <div class="showimg showimgadd"></div>
                <div class="imagesadd">+</div>
                <input type="file" accept="image/jpg,image/jpeg,image/png" class="input sort" name="serial" id="addimage" >
                <div class="progress">
                    <div class="bar"></div>
                    <!--<div class="percent"></div>-->
                </div>
                <span class="fi-help-text" style="left:85px; position:absolute; top:40px; width:150px; height:20px;">建议大小:（宽1920高900）</span>
            </div>
        </div>
        <div class="formitems" style=" height:60px;">
            <label class="fi-name"><span class="colorRed"></span>手机端图片：</label>
            <div class="form-controls images">
                <div class="showimg showimgadd1"></div>
                <div class="imagesadd">+</div>
                <input type="file"  accept="image/jpg,image/jpeg,image/png,image/svg" class="input sort" name="serial" id="addimage1" >
                <div class="progress">
                    <div class="bar"></div>
                    <!--<div class="percent"></div>-->
                </div>
                <span class="fi-help-text" style="left:85px; position:absolute; top:40px; width:150px; height:20px;">建议大小:（宽750高550）<!--建议大小:轮播图（宽300高150）横幅（宽300高100）--></span>
            </div>
        </div>
    </div>
    <div class="jbox-buttons"><a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="addcategory">确定</a><a
            href="javascript:void (0);" class="jbox-buttons-ok btn cancle">取消</a></div>
</div>
<div class="jbox editfenlei disshow">
    <div class="jbox-title">
        <div class="jbox-title-txt">修改广告</div>
        <a href="javascript:void(0)" class="jbox-close cancle"></a></div>
    <div class="jbox-container" style="height: 263px;">

        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>图片分类：</label>
            <div class="form-controls">
                <select name='type' id="pictype" style='padding:5px;border: 1px solid #ccc;width:182px' id='editfid'>
                    <option value="">--请选择--</option>
                    <foreach name="bannertypelist" item="vo" >
                        <option value="{$vo.id}">{$vo.classname}</option>
                    </foreach>
                </select>
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片链接：</label>
            <div class="form-controls">
                <input type="text" class="input url">
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片手机端链接：</label>
            <div class="form-controls">
                <input type="text"  class="input tel_url">
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片标题：</label>
            <div class="form-controls">
                <input type="text" class="input title">
                <span class="fi-help-text"></span> </div>
        </div>

        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>图片小标题：</label>
            <div class="form-controls">
                <input type="text" class="input title1">
                <span class="fi-help-text"></span> </div>
        </div>

        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>内容：</label>
            <div class="form-controls">
                <input type="text" class="input content">
                <span class="fi-help-text"></span> </div>
        </div>


        <div class="formitems" style=" height:60px;">
            <input type="hidden" name="id" id="picid">
            <label class="fi-name"><span class="colorRed">*</span>电脑端图片：</label>
            <div class="form-controls images">
                <div class="showimg showimgedit"></div>
                <div class="imagesadd">+</div>
                <input type="file"  accept="image/jpg,image/jpeg,image/png,image/svg" class="input sort" name="serial" id="editimage" >
                <div class="progress">
                    <div class="bar"></div>
                    <!--<div class="percent"></div>-->
                </div>
                <span class="fi-help-text" style="left:85px; position:absolute; top:40px; width:150px; height:20px;">建议大小:（宽1920高900）<!--建议大小:轮播图（宽1920px高900px）横幅（宽300高100）--></span>
            </div>
        </div>
        <div class="formitems" style=" height:60px;">
            <label class="fi-name"><span class="colorRed"></span>手机端图片：</label>
            <div class="form-controls images">
                <div class="showimg showimgedit1"></div>
                <div class="imagesadd">+</div>
                <input type="file"  accept="image/jpg,image/jpeg,image/png,image/svg" class="input sort" name="serial" id="editimage1" >
                <div class="progress">
                    <div class="bar"></div>
                    <!--<div class="percent"></div>-->
                </div>
                <span class="fi-help-text" style="left:85px; position:absolute; top:40px; width:150px; height:20px;">建议大小:（宽750高550）<!--建议大小:轮播图（宽300高150）横幅（宽300高100）--></span>
            </div>
        </div>
    </div>
    <div class="jbox-buttons"><a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="editcategory">确定</a><a
            href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a></div>
</div>


<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript">
    $(".cancle").click(function(){
        $(this).parent().parent('.jbox').hide();
        $('#albums-overlay').hide();
    });

    $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#addimage").wrap("<form id='myupload' action='{:U('Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#addimage").change(function(){ //选择文件
            $("#myupload").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="pic" id="addpic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.showimgadd').html(img);
                    $("#addimage").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });
    $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#addimage1").wrap("<form id='myupload1' action='{:U('Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#addimage1").change(function(){ //选择文件
            $("#myupload1").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="tel_pic" id="addpic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.showimgadd1').html(img);
                    $("#addimage1").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });


    $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#editimage").wrap("<form id='myupload2' action='{:U('Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#editimage").change(function(){ //选择文件
            $("#myupload2").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="pic" id="editpic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                    $('.showimgedit').html(img);
                    $("#editimage").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });
     $(function () {
        var progress = $(".img");
        var bar = $('.bar') ;
        var percent = $('.percent');
        var progress = $('.progress');
        $("#editimage1").wrap("<form id='myupload3' action='{:U('Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
        $("#editimage1").change(function(){ //选择文件
            $("#myupload3").ajaxSubmit({
                dataType:  'json', //数据格式为json
                beforeSend: function() { //开始上传
                    progress.show(); //显示进度条
                    var percentVal = '0%';
                    bar.width(percentVal);
                    percent.html(percentVal);
                },
                uploadProgress: function(event, position, total, percentComplete) {
                    var percentVal = percentComplete + '%'; //获得进度
                    bar.width(percentVal); //上传进度条宽度变宽
                    percent.html(percentVal); //显示上传进度百分比
                },
                success: function(data) { //成功
                    var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="tel_pic" id="editpic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"/>';
                    $('.showimgedit1').html(img);
                    $("#editimage1").val('');
                    progress.hide();
                },
                error:function(xhr){ //上传失败
                    //console.log(xhr.status)
                }
            });
        });
    });



</script>
<script>

</script>

<!--添加广告-->

<script type="text/javascript">
    $(".BtnAddClass").click(function(){
        $('.addfenlei').show();
        $('#albums-overlay').show();
    })
</script>
<script type="text/javascript">
    $("#addcategory").click(function(){
        var type = $(".addfenlei select[name=type]").val();
        var pic = $('#addpic').val();  //父分类id
        var tel_pic = $('#addpic1').val();
        var purl = $(".addfenlei .url").val();
        var ptitle = $(".addfenlei .title").val();
        var ptitle1 = $(".addfenlei .title1").val();
        var content = $('.content').val();
        var tel_url = $(".addfenlei .tel_url").val();
        if (!type) {
            alert("请选择分类");
            return false;
        }
        if (pic == '') {
            alert("请添加图片");
            return false;
        }
        $.ajax({
            url: "{:U('/Admin/Index/addPic')}",
            type: "post",
            dataType: "json",
            data: {
                tel_pic:tel_pic,
                pic: pic,
                type:type,
                url:purl,
                title:ptitle,
                title1:ptitle1,
                content:content,
                tel_url:tel_url
            }
        }).done(function (g) {
            if (g.status == 1) {
                alert(g.info);
                window.location.reload();
            } else {
                alert(g.info);
            }
        })
    })
</script>
<!--添加广告end-->

<!--修改广告-->
<script type="text/javascript">
    var categoryid;
    $(".j-editClass").click(function(){
        var type = $(this).attr("data-type");
        var purl = $(this).attr("data-url");
        var ptitle = $(this).attr("data-title");
        var ptitle1 = $(this).attr("data-title1");
        var content = $(this).attr('data-content');
        var tel_url = $(this).attr('data-tel_url');
        $("#pictype").val(type);

        //alert(type);
        $(".editfenlei .content").val(content);
        $(".editfenlei .url").val(purl);
        $(".editfenlei .tel_url").val(tel_url);
        $(".editfenlei .title").val(ptitle);
        $(".editfenlei .title1").val(ptitle1);
        $('.editfenlei').show();
        $('#albums-overlay').show();
        var pic=$(this).attr('data-pic');
        var pics=$(this).attr('data-tel-pic');
        var id=$(this).attr('data-id');
        $("#picid").val(id);
        var img = '<img src="'+pic+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="pic" id="editpic" value="'+pic+'"></input>';
        var imgs = '<img src="'+pics+'" width="80" height="56" style="margin-top:-28px;"><input type="hidden" name="tel_pic" id="editpic1" value="'+pics+'"></input>';
        $('.showimgedit').html(img);
        $('.showimgedit1').html(imgs);
    })
    //
    //删除分类
        $('.j-delClass').click(function(){
            //alert('123');return false;
            var id = $(this).data('id');
            //alert(id);return false;
            dialog.showTips('是否删除？','firm',function(){
                window.location.href = "/Admin/Index/delpic/id/"+id;
            })
        })
       
    $("#editcategory").click(function(){
        var pic = $('#editpic').val();
        var tel_pic = $('#editpic1').val();
        var id = $("#picid").val();
        var type = $("#pictype").val();
        var purl = $(".editfenlei .url").val();
        var ptitle = $(".editfenlei .title").val();
        var ptitle1 = $(".editfenlei .title1").val();
        var content = $(".editfenlei .content").val();
        var tel_url = $(".editfenlei .tel_url").val();
//alert(categoryid);
        if (id == '') {
            alert("图片不存在");
            return false;
        }
        if (pic == '') {
            alert("请添加图片");
            return false;
        }
        if (!type){
            alert("请选择正确的分类");
            return false;
        }
        $.ajax({
            url: "{:U('/Admin/Index/editPic')}",
            type: "post",
            dataType: "json",
            data: {
                pic: pic,
                tel_pic: tel_pic,
                id:id,
                type:type,
                url:purl,
                title:ptitle,
                title1:ptitle1,
                content:content,
                tel_url:tel_url
            }
        }).done(function (g) {
            if (g.status == 1) {
                alert(g.info);
                window.location.reload();
            } else {
                alert(g.info);
            }

        })
    })

    //多选删除
    $('.del').click(function(){
        var ID ='';
        if($('.check:checked').length ==0){
            alert('请选择要删除的数据');return false;
        }
        if(confirm('确定删除吗！')){
            $('.check:checked').each(function(){
                ID = ID + $(this).attr("data-id") + '_';
            });


            $.post("{:U('Admin/Index/delallbanner')}",{'id':ID},function(data){
                if(data.status==1){
                    alert(data.info);
                    location.reload();
                }
            },'json');
        }
    })



</script>
