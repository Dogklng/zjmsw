<include file="Public:head"/>
<script src="__LAYDATE__/laydate.js"></script>
<style>
	.imgnav{
		max-height: 30px;
		overflow: hidden;
		cursor: pointer;
	}
	.imgwrapper{
		display: block;
		width: 78px;
		height: 78px;
		overflow: hidden;
	}
	.imgwrapper img{
		display: block;
		width: 100%;
		padding: 0;
		margin: 0;
		border:0;
	}
	.spanpd10{
		margin:10px;
	}
	.wxtables.wxtables-sku.newtable{
		width: 40%;
		margin: 0;
	}
	.img-list li{
		width: 60px;
		height:60px;
	}
    .input{
      height: 30px;
    }
	.cst_h3 span{font-weight: normal;}
	#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
	.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
	.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
	#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
	#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
	#xuanze2:hover{ background:#E6E6E6; }
	.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>


<!--<script type="text/javascript" src="__C_JS__/jquery-1.7.1.min.js"></script>-->

<div class="container">
  <div class="inner clearfix">
    <include file="Public:left"/>
    <!-- end content-left -->

    <div class="content-right fl">
      <h1 class="content-right-title">添加拍卖场次</h1>
      <input type="hidden" id="j-isSid" value="0">
      <!-- 是否选择了淘宝类目 -->
      <input type="hidden" id="j-hasNorms" value="1">
      <!-- 淘宝类目下是否有属性 -->
      <input type="hidden" id="supplier" value="">
      <form aciton="{:U('/Admin/Pm/addPmNum')}" enctype="multipart/form-data" method="post" id="add_step2">
        <div class="panel-single panel-single-light mgt20">
          <!--<h3 class="cst_h3 mgb20">最近场次信息</h3>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>普通场：</label>
            <div class="form-controls">
              <span>第{$res.num}场 时间段：{$res['start_time']|date='Y-m-d H:i:s',###}-{$res['end_time']|date='Y-m-d H:i:s',###}</span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>限时场：</label>
            <div class="form-controls">
              <span>第{$resx.num}场 时间段：{$resx['start_time']|date='Y-m-d H:i:s',###}-{$resx['end_time']|date='Y-m-d H:i:s',###}</span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>提示信息：</label>
            <div class="form-controls">
              <span style="color: red">添加场次的开始时间必须大于该场次类型最近场次结束时间</span>
            </div>
          </div>-->



          <h3 class="cst_h3 mgb20">基本信息</h3>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>拍卖场次：</label>
            <div class="form-controls">
              <input type="text" class="input" id="num" maxlength="30" name="num" style="width:220px;">
            </div>
          </div>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>专场名称：</label>
            <div class="form-controls">
              <input type="text" class="input" maxlength="15" id="name" name="name" style="width:220px;">
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>主题信息：</label>
            <div class="form-controls">
              <textarea type="text" class="input" maxlength="50" id="topic_info" name="topic_info" style="width:220px;height: 80px"></textarea>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>场次类型：</label>
            <div class="form-controls">
              <input type="radio" class="input mini" value="0" name="is_xs" checked="checked" >
              <label >普通场</label>
              <input type="radio" class="input mini" value="1" name="is_xs" >
              <label >限时场</label>
              <input type="radio" class="input mini" value="2" name="is_xs" >
              <label >公益场</label>
            </div>
          </div>

          <div class="formitems">
              <label class="fi-name"><span class="colorRed">*</span>起始时间：</label>
              <div class="form-controls">
                <input class="laydate-icon" id="demo" name="start_time" style="padding:0px 5px;width:220px;height:28px;line-height:30px;"/>
                <span class="fi-help-text"></span>
              </div>
            </div>

            <div class="formitems">
              <label class="fi-name"><span class="colorRed">*</span>结束时间：</label>
              <div class="form-controls">
                <input class="laydate-icon" id="demo1" name="end_time" style="padding:0px 5px;width:220px;height:28px;line-height:30px;"/>
                <span class="fi-help-text"></span>
              </div>
            </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>背景图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
              <div class="baotuan_showimge fl mgr10">
              </div>
              <div class="btnimage fl">选择图片
                <input type="file"  accept="image/jpg,image/jpeg,image/png" name="baotuan" id="baotuan" class="file" >
              </div>
              <div class="baotuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" />
                <span class="baotuan_percent">80%</span>
              </div>
              <span class="fi-help-text fl lh30 mgl10">建议大小(宽1920高900）</span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>排序：</label>
            <div class="form-controls">
              <input type="text" class="input mini" name="sort" value="0">
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>专场简介：</label>
            <div class="form-controls">
              <script id="editor" name="detail" type="text/plain" style="width:730px;height:300px;"></script></div>
          </div>

        </div>
        <!-- end 基本信息 -->
        <div class="panel-single panel-single-light mgt20 txtCenter">
          <a href="{:U('Admin/Pm/pmNumList')}" class="btn">取消</a>
          <input type="button" onclick="toVaild()" class="btn btn-primary" value="保存">
        </div>
      </form>


      <link href="__UM__/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
      <script type="text/javascript" src="__UM__/third-party/jquery.min.js"></script>
        <script type="text/javascript" src="__UM__/third-party/template.min.js"></script>
      <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.config.js"></script>
      <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.min.js"></script>
      <script type="text/javascript" src="__UM__/lang/zh-cn/zh-cn.js"></script>
      <script>
          UM.getEditor('editor',{
              toolbars: [

                  ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']

              ],

              autoHeightEnabled: false,
              autoFloatEnabled: true,
              elementPathEnabled:false,
              enableContextMenu:false,
              wordCount:false,

          });
      </script>
      <script type="text/javascript" src="__JEDATE__/jedate.js"></script>
      <script type="text/javascript">
          $(document).ready(function(){

              jeDate.skin('gray');
              jeDate({
                  dateCell:"#demo",
                  format:"YYYY-MM-DD hh:mm:ss",
                  isinitVal:false,
                  isTime:true, //isClear:false,
                  minDate:"2014-09-19 00:00:00",
                  okfun:function(val){alert(val)}
              })

              jeDate({
                  dateCell:"#demo1",
                  format:"YYYY-MM-DD hh:mm:ss",
                  isinitVal:false,
                  isTime:true, //isClear:false,
                  minDate:"2014-09-19 00:00:00",
                  okfun:function(val){alert(val)}
              })

          });


      </script>
  <script type="text/javascript">

    function toVaild(){
        var num = $.trim($('#num').val());
        var demo = $.trim($('#demo').val());
        var demo1 = $.trim($('#demo1').val());
        var name = $.trim($('input[name="name"]').val());
        var topic_info = $.trim($('#topic_info').val());
        var backg_pic = $('input[name="backg_pic"]').val();

        if(num==''||num==null){
            alert('拍卖场次必填');
            $('#num').focus();
            return false;
        }

        if(name==''||name==null){
            alert('场次名称必填');
            $('#name').focus();
            return false;
        }

        if(topic_info==''||topic_info==null){
            alert('主题信息必填');
            $('#topic_info').focus();
            return false;
        }

        if(demo==''||demo==null){
            alert('开始时间必填');
            $('#demo').focus();
            return false;
        }

        var myDate = new Date();
        var time =myDate.getTime();
        var demo2 = new Date(demo);
        var demo3 = demo2.getTime();
            if(demo3<=time){
                alert('开始时间必须大于当前时间');
                $('#demo1').focus();
                return false;
            }
        if(demo1==''||demo1==null){
            alert('结束时间必填');
            $('#demo1').focus();
            return false;
        }

        if(demo>=demo1){
            alert('结束时间必须大于开始时间');
            $('#demo').focus();
            return false;
        }


        /*if(demo3<=time){
            alert('结束时间必须大于当前时间');
            $('#demo1').focus();
            return false;
        }*/
        //console.log(backg_pic);return false;
        if(backg_pic==undefined){
            alert('背景图片必传');
            return false;
        }


        //var num = $('#num').val();
        $.ajax({
            url: "{:U('/Admin/Pm/addPmNum')}",
            type: "post",
            dataType: "json",
            data:$("form").serialize(),
            async: false,
            success:function(msg){
                //console.log();
                if (msg.status==1){
                    alert( msg.info);
                    setTimeout(location.href="{:U('/Admin/Pm/pmNumList')}",5000);


                    return false;
                    //$('#add_step2').submit();
                }else{
                    alert( msg.info);
                    return false;
                }
            }
        })

        return false;
}
</script>
<!--提交表单前验证end-->

<!--上传图片-->
<!--<script type="text/javascript" src="__JS__/jquery.js"></script>-->
<script type="text/javascript" src="__JS__/uploadPreview.min.js"></script>

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
      <script>
        $(function () {
            var percent = $('.baotuan_percent');
            var progress = $('.baotuan_percent');
            $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
            $("#baotuan").change(function(){ //选择文件
                $("#baotuan1").ajaxSubmit({
                    dataType:  'json', //数据格式为json
                    beforeSend: function() { //开始上传
                        progress.show(); //显示进度条
                        var percentVal = '0%';
                        percent.html(percentVal);
                    },
                    uploadProgress: function(event, position, total, percentComplete) {
                        var percentVal = percentComplete + '%'; //获得进度
                        percent.html(percentVal); //显示上传进度百分比
                    },
                    success: function(data) { //成功
                        //console.log(data);return false;
                        var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="backg_pic" id="pic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                        $('.baotuan_showimge').html(img);
                        progress.hide();
                    },
                    error:function(xhr){ //上传失败
                        //console.log(xhr.status)
                    }
                });
            });
        })
      </script>
<!--<script>
    ;!function(){
        laydate({
            elem: '#demo',
            format: 'YYYY-MM-DD hh:mm:ss',
        })

    }();

    ;!function(){
        laydate({
            elem: '#demo1',
            format: 'YYYY-MM-DD hh:mm:ss',
        })

    }();
</script>-->













