<include file="Public:head"/>
<style>
	.imgnav{
		max-height: 30px;
		overflow: hidden;
		cursor: pointer;
	}
	.imgwrapper{
		display: block;
		width: 78px;
		height: 78px;
		overflow: hidden;
	}
	.imgwrapper img{
		display: block;
		width: 100%;
		padding: 0;
		margin: 0;
		border:0;
	}
	.spanpd10{
		margin:10px;
	}
	.wxtables.wxtables-sku.newtable{
		width: 40%;
		margin: 0;
	}
	.img-list li{
		width: 60px;
		height:60px;
	}
	.cst_h3 span{font-weight: normal;}
	#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
	.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
	.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
	#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
	#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
	#xuanze2:hover{ background:#E6E6E6; }
	.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}

</style>
<script src="__LAYDATE__/laydate.js"></script>
<div class="container">
  <div class="inner clearfix">
    <include file="Public:left"/>
    <!-- end content-left -->

    <div class="content-right fl">
      <input type="hidden" id="j-isSid" value="0">
      <!-- 是否选择了淘宝类目 -->
      <input type="hidden" id="j-hasNorms" value="1">
      <!-- 淘宝类目下是否有属性 -->
      <input type="hidden" id="supplier" value="">
      <h1 class="content-right-title">发布作品</h1>
      <form aciton="{:U('/Admin/Goods/addShow')}" enctype="multipart/form-data" method="post" id="add_step2">
        <!-- end 基本信息 -->

        <div class="panel-single panel-single-light mgt20">
          <h3 class="cst_h3 mgb20">展览品</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>标题：</label>
            <div class="form-controls">
              <input type="text" class="input xxlarge" name="title" id="title" value="">
              <span class="fi-help-text"></span> 
            </div>
          </div>


          <!--<div class="formitems">-->
            <!--<label class="fi-name"><span class="colorRed">*</span>描述：</label>-->
            <!--<div class="form-controls">-->
              <!--<textarea name="detail" id="detail" style="width:420px;height: 100px;"></textarea>-->
              <!--<span class="fi-help-text"></span>-->
            <!--</div>-->
          <!--</div>-->

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>开始时间：</label>
            <div class="form-controls">
              <input type="text" class="laydate-icon" name="start" id="start" value="">
              <span class="fi-help-text"></span> 
            </div>
          </div>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>结束时间：</label>
            <div class="form-controls">
              <input type="text" class="laydate-icon" name="end" id="end" value="">
              <span class="fi-help-text"></span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>地点：</label>
            <div class="form-controls">
              <input type="text" class="input" name="address" maxlength="30" id="address" value="">
              <span class="fi-help-text"></span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>作者：</label>
            <div class="form-controls">
              <input type="text" class="input" name="auth" maxlength="20" id="auth" value="">
              <span class="fi-help-text"></span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>排序：</label>
            <div class="form-controls">
              <input type="text" class="input" name="sort" maxlength="12" id="sort" value="">
              <span class="fi-help-text"></span>
            </div>
          </div>

          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>logo图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
              <div class="xuanze_showimge fl mgr10">
              </div>
              <div class="btnimage fl">选择图片
              <input type="file"  accept="image/jpg,image/jpeg,image/png" name="logo" id="xuanze" class="file" >
              </div>
              <div class="xuanze_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="xuanze_percent">80%</span>
              </div>
              <span class="fi-help-text fl lh30 mgl10">建议大小（宽305px高204px）</span>
          </div>
          </div>


          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>作品展示图片：</label>
            <div class="form-controls pdt5 j-imglistPanel">
              <div class="baotuan_showimge fl mgr10">
              </div>
              <div class="btnimage fl">选择图片
                <input type="file"  accept="image/jpg,image/jpeg,image/png" name="detail_img" id="baotuan" class="file" >
              </div>
              <div class="baotuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" />
                <span class="baotuan_percent">80%</span>
              </div>
              <span class="fi-help-text fl lh30 mgl10">首张建议大小（宽1920px高650px）</span>
            </div>
          </div>

      </div>

      <div class="panel-single panel-single-light mgt20 j-showinhyd" style="display: block;">
        <h3 class="cst_h3 mgb20">简介</h3>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>作品简介：</label>
          <div class="form-controls">
            <script id="editor" name="content" type="text/plain" style="width:730px;height:300px;"></script>
          </div>
        </div>
      </div>
    </div>

    <!-- end 详情及其它 -->

    <div class="panel-single panel-single-light mgt20 txtCenter">
      <a href="{:U('Admin/Goods/show')}" class="btn">取消</a>
      <input type="button" class="btn btn-primary" onclick="toVaild()" value="保存">
    </div>
  </form>
</div>
<!-- end container -->

<include file="Public:foot"/>
              <link href="__UM__/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
              <script type="text/javascript" src="__UM__/third-party/jquery.min.js"></script>
            <script type="text/javascript" src="__UM__/third-party/template.min.js"></script>
            <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.config.js"></script>
            <script type="text/javascript" charset="utf-8" src="__UM__/umeditor.min.js"></script>
            <script type="text/javascript" src="__UM__/lang/zh-cn/zh-cn.js"></script>
  <script>
    ;!function(){
     laydate({
     elem: '#start',
     format: 'YYYY-MM-DD',
     })

     }();

    ;!function(){
     laydate({
     elem: '#end',
     format: 'YYYY-MM-DD',
     })

     }();

    /*;!function(){
     laydate({
     elem: '#demo2',
     format: 'YYYY',
     })

     }();
     ;!function(){
     laydate({
     elem: '#demo3',
     format: 'YYYY',
     })

     }();*/
  </script>
                <script type="text/javascript">


  $("#j-select_category_id").click(function(){
    $('.select-fenlei').show();
    /*$('#albums-overlay').show();*/
  });
  $(".cancle").click(function(){
    $(this).parent().parent('.jbox').hide();
    /*$('#albums-overlay').hide();*/
  });

  $("#select_class").click(function(){
    var clssid=$("#select_class_id  option:selected").val();
    var classname=$("#select_class_id option:selected" ).text();
    $('#class_id').val(clssid);
    $('#class_name').val(classname);
    $(this).parent().parent('.jbox').hide();
    /*$('#albums-overlay').hide();*/
  });

  $("#j-select_series_id").click(function(){
    $('.select-series').show();
    $('#albums-overlay1').show();
  });
  $(".cancle").click(function(){
    $(this).parent().parent('.jbox').hide();
    $('#albums-overlay1').hide();
  });

  $("#select_series").click(function(){
    var seriesid=$("#select_series_id  option:selected").val();
    var seriesname=$("#select_series_id option:selected" ).text();
    $('#series_id').val(seriesid);
    $('#series_name').val(seriesname);
    $(this).parent().parent('.jbox').hide();
    $('#albums-overlay1').hide();
  });





  UM.getEditor('editor',{
    toolbars: [

    ['source', 'fontfamily','fontsize','bold','italic', 'underline','forecolor','redo','undo','insertunorderedlist','insertorderedlist','cleardoc', 'justifyleft','justifyright','justifycenter','justifyjustify','insertimage','inserttable','insertrow','insertcol', "mergeright", "mergedown", "deleterow", "deletecol", "splittorows", "splittocols", "splittocells", "deletecaption",  'inserttitle', 'mergecells', 'deletetable','cleardoc','insertparagraphbeforetable', 'edittable', 'edittd']

    ],

    autoHeightEnabled: false,
    autoFloatEnabled: true,
    elementPathEnabled:false,
    enableContextMenu:false,
    wordCount:false,

  });

</script>


  <script type="text/javascript">
    function toVaild(){
        var title = $.trim($('#title').val());
        var start = $.trim($('#start').val());
        var end = $.trim($('#end').val());
        var address = $.trim($('#address').val());
        var auth = $.trim($('#auth').val());
//        var pic = $('#pic2').val();
//        var content = $('#content').val();
//
        if(title==""){
            alert('请填写标题！');
            return false;
        }
//
//        if(detail == ''){
//            alert('描述不能为空');
//            return false;
//        }
        if(start == ''){
            alert('请填写开始时间！');
            return false;
        }

        if(end == ''){
            alert('请填写结束时间！');
            return false;
        }

        if(start > end){
            alert('开始时间需小于结束时间！');
            return false;
        }

        var time = new Date();
        var time1 = time.getTime();

        var end1 = new Date(end);
        var end2 = end1.getTime();
        if(time1 > end2){
            alert('结束时间需大于当前时间！');
            return false;
        }

        if(address == ''){
            alert('请填写地点！');
            return false;
        }

        if(auth == ''){
            alert('请填写作者！');
            return false;
        }
//        if(news_pic ==undefined){
//            alert('图片不能为空');
//            return false;
//        }
//        if(pic == undefined){
//            alert('图片不能为空');
//            return false;
//        }


        $.ajax({
            url:'/Admin/Goods/addShow',
            type:'post',
            data:$("form").serialize(),
            dataType:'json',
            async: false,
            success:function(data){
                if(data.status == 1){
                    alert(data.info);
                    setTimeout(href,1200);
                    return false;
                }else{
                    alert(data.info);
                    return false;
                }

            }
        })
        
        function href() {
            location.href="{:U('/Admin/Goods/show')}";
        }


}
</script>
<!--提交表单前验证end-->

<!--上传图片-->
<!--
<script type="text/javascript" src="__JS__/jquery.js"></script>-->

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript">

  function delImg(obj){
    if(!confirm("删除这张图片？")){
      return false;
    }
    var id = $(obj).attr("data-id");
    if(id){
      alert(1);
      return false;
    }
    $(obj).next("input").remove();
    $(obj).remove();
  }
  $(function () {
    var percent = $('.xuanze_percent');
    var progress = $('.xuanze_percent');
    $("#xuanze").wrap("<form id='myupload1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#xuanze").change(function(){ //选择文件
			$("#myupload1").ajaxSubmit({
				dataType:  'json', //数据格式为json
				beforeSend: function() { //开始上传
					progress.show(); //显示进度条
					var percentVal = '0%';
					percent.html(percentVal);
				},
				uploadProgress: function(event, position, total, percentComplete) {
					var percentVal = percentComplete + '%'; //获得进度
					percent.html(percentVal); //显示上传进度百分比
				},
				success: function(data) { //成功
					var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="logo" id="logo" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
					$('.xuanze_showimge').html(img);
					progress.hide();
				},
				error:function(xhr){ //上传失败
					//console.log(xhr.status)
				}
			});
		});



		var percent = $('.baotuan_percent');
    var progress = $('.baotuan_percent');
    $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#baotuan").change(function(){ //选择文件
      $("#baotuan1").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="detail_img" id="detail_img" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
          $('.baotuan_showimge').html(img);
          progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });

  });
  function add_re(r){
   $('#restriction'+r).show();
 }
 function del_re(r){
   $('#restriction'+r).hide();
 }
</script>













