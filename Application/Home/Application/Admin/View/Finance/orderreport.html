<include file="Public:head"/>

<style>
    .pages a{
        width: 50px;
    }
    .ftnormal {line-height: 25px!important;}
    .btn{vertical-align: baseline;}
    .newinput{ width:145px;}
    .select.mini{width: 110px;}
    .vtal-2{vertical-align: -2px;}
    .shady{ background:#000; opacity:0.5; width:100%; height:100%; position:fixed; top:0; left:0; z-index:111111; display:none; }
</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>
<div class="container">
<div class="inner clearfix">
    <include file="Public:left"/>
<!-- end content-left -->
<div class="shady" id="heemu"></div>
<img src="" id="em" style="position:fixed;width:34%;margin:auto;left:0;right:0;display:none;z-index:11111111111111;cursor:pointer;" onclick="this.style.display='none',document.getElementById('heemu').style.display='none'"/>
<div class="content-right fl">


    <h1 class="content-right-title">订单统计明细</h1>


    <table class="wxtables data mgt15">
        <colgroup>
            <col width="13%">
            <col width="13%">
            <col width="13%">
            <col width="13%">
            <col width="13%">
            <col width="13%">
            <col width="13%">
        </colgroup>
        <thead>
        <tr>
            <td colspan="8" class="left" style="font-size:14px;">统计
                <form action="{:U('Admin/Finance/OrderReport')}" method="post">
                    <!--<input type="text" autocomplete="off" name="dayStartTime" id="dayStartTime" value="{$dayStartTime}" placeholder="起始日期" class="input Wdate" />-->
                    <input class="laydate-icon" id="start_time" name="timegap" value="{$timegap}" style="padding:0px 5px;width:220px;height:28px;line-height:30px;"/>
                    <button class="btn btn-primary"><i class="gicon-search white"></i>查询</button>
                </form>
                <!--<a href="javascript:;"><button class="btn btn-success car_export" style="float:right;"><i
                        class="gicon-search white"></i>excel导出
                </button></a>-->
            </td>

        </tr>
        </thead>
        <tbody>
        <tr>
            <td><div class="dataItems">订单总数</div><div class="dataItems"> <span class="num1">{$dayZnum|default="0"}</span> </div></td>
            <td><div class="dataItems">订单总金额</div><div class="dataItems"> <span class="num1">￥{$dayMoney|default="0"}</span> </div></td>
        </tr>
        </tbody>
    </table>

    <!--销售额走势-->
    <div class="chartWrap mgt15 clearfix">
        <div class="col-md-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">销售额走势</h3>
                    <div class="box-tools"></div>
                    <div class="box-tools pull-right">
                        <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                        <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div class="chart">
                        <div id="statistics" style="height: 400px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--销售额走势-->

    <div class="tabs clearfix mgt15">
        <table class="wxtables table-order mgt20" id="tb_3">
            <thead>
                <tr>
                    <td align="center">订单用户</td>
                    <td align="center">订单金额</td>
                    <td align="center">实际支付</td>
                    <td align="center">支付时间</td>
                    <td align="center">支付类型</td>
                    <td align="center">订单状态</td>
                </tr>
            </thead>
            <tbody>
            <volist name="cache" id="vo">
                    <tr>
                        <td colspan="8" class="ftnormal" style="background-color:#F2F8FC;">
                            <span>订单编号：<b>{$vo.order_no}</b></span>
                            <span class="mgl15">{$vo.order_time|date="Y-m-d H:i:s",###}</span>
                            <!---->
                            <span class="mgl15 colorRed">
                                <switch name="vo.order_status">
                                    <case value="1">未支付</case>
                                    <case value="2">已支付</case>
                                </switch>

                            </span>
                         </td>
                    </tr>
                    <tr>
                        <td valign="top" class="txtCenter" style="padding-top:15px;vertical-align: inherit;">
                            <p><b>用户：</b>{$vo.person_name}</p>
                            <p><b>手机：</b>{$vo.telephone}</p>
                        </td>
                        <td valign="top" class="txtCenter" style="padding-top:15px;vertical-align: inherit;">
                            <p><b>¥<if condition="$vo['total_price']">{$vo.total_price}<else />0.00</if></b></p>
                        </td>


                        <td valign="middle" align="center" class="txtCenter">
                            <p><b>¥<if condition="$vo['pay_price']">{$vo.pay_price}<else />0.00</if></b></p>
                        </td>

                        <td valign="middle" align="center"  class="txtCenter">
                            <notempty name="vo['pay_time']">
                            <p><b>{$vo.pay_time|date="Y-m-d H:i:s",###}</b></p>
                            <else />
                            <p><b>未支付</b></p>
                            </notempty>
                        </td>

                        <!-- 0待接受 1 申请中 2 任务开始 3任务完成  4确认任务完成 5 取消任务 6退款 7任务结束 -->
                        <td valign="middle" align="center"  class="txtCenter">
                            <p><b>
                            <switch name="vo.pay_way">
                                <case value="0">未知支付方式</case>
                                <case value="1">支付宝</case>
                                <case value="2">微信支付</case>
                                <case value="3">银行卡</case>
                                <case value="4">余额</case>
                            </switch>
                            </b></p>
                        </td>

                        <td valign="middle" align="center"  class="txtCenter">
                            <p>
                            <switch name="vo.order_status">
                                <case value="0">已取消</case>
                                <case value="1">待付款</case>
                                <case value="2">待发货</case>
                                <case value="3">待收货</case>
                                <case value="4">已签收</case>
                                <case value="5">已关闭</case>
                                <case value="6">退款中</case>
                            </switch>
                            </p>
                        </td>
                       <!-- <td valign="top" style="vertical-align: inherit;">
                            <p>
                                <a href="{:U('Admin/tongji/zxDetail')}/id/{$vo.id}" class="btn btn-mini btn-primary">查看详情</a>
                            </p>

                        </td>-->
                    </tr>

 </volist>
            </tbody>
            </table>



        <!-- end wxtables -->
        <div class="tables-btmctrl clearfix mgt10">
            <div class="fl" style="display:none;">
                <a href="javascript:;" class="btn btn-primary btn_table_selectAll">全选</a>
                <a href="javascript:;" class="btn btn-primary btn_table_Cancle">取消</a>
                <!-- <a href="javascript:void(0)" onclick="del()" class="btn btn-danger J_batch_del">删除订单</a> -->
            </div>

            <div class="pages" style="float:none;width:100%;text-align:center;padding-top:10px;">
                {$page}
            </div>
                <!-- end paginate -->

        </div>        <!-- end tables-btmctrl -->


    <form action="" method="post" id="ids">
        <input type="hidden" name="ids" value="">
    </form>


</div>
<!-- end content-right -->
</div>
</div>
    </div>
<!-- end container -->


<div class="jbox editfenlei disshow quxiao" style="height:255px;">
  <div class="jbox-title">
    <div class="jbox-title-txt">发货信息</div>
    <a href="javascript:;" class="jbox-close cancle"></a></div>
  <div class="jbox-container">

    <div class="formitems">
      <label class="fi-name"><span class="colorRed">*</span>快递公司：</label>
      <div class="form-controls">
        <select name="express_name" id="">
        <foreach name="express_list" item="vo">
            <option value="{$vo['express_ma']}">{$vo['express_company']}</option>
            </foreach>
        </select>

        <span class="fi-help-text"></span> </div>
    </div>
      <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>快递单号：</label>
          <div class="form-controls">
<input type="text" onKeyUp="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" class="input describe1" name="express_no">
              <span class="fi-help-text"></span> </div>
      </div>
      <!-- <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>快递价格：</label>
          <div class="form-controls">
              <input type="text" class="input describe2" name="express_fee">
              <span class="fi-help-text"></span> </div>
      </div> -->
      <div class="jbox-buttons" style="text-align:center;">
      <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="fahuo">确定发货</a>
      <a href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a>
      </div>
</div>
    </div>

<div id="note-overlay" class="disshow"></div>
<div class="jbox addNoteInfo disshow" style="position:fixed;width:400px;height:190px;left:50%;top:50%;margin-left:-200px;margin-top:-194px;z-index:999998;">
  <div class="jbox-title">
    <div class="jbox-title-txt">添加备注</div>
    <a href="javascript:;" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="padding: 0px;">
    <div class="formitems" style="margin-top: 17px;">
      <label class="fi-name"><span class="colorRed">*</span>备注信息：</label>
      <div class="form-controls">
        <!-- <input type="text" class="input note_info" name="note_info" id="addNoteInfo"> --><input type="hidden" id="note_orderid">
        <textarea rows="5" cols="30"  name="note_info" id="addNoteInfo"></textarea>
        <span class="fi-help-text"></span> </div>
    </div>
  </div>
  <div class="jbox-buttons"><a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="saveNoteInfo">确定</a><a href="javascript:;" class="jbox-buttons-ok btn cancle">取消</a></div>
</div>

<!--gonggao-->
<include file="Public:foot"/>
<link rel="stylesheet" type="text/css" href="__JS__/daterangepicker/bootstrap.css" />
<script src="__JS__/daterangepicker/moment.min.js" type="text/javascript"></script>
<script src="__JS__/daterangepicker/daterangepicker.js" type="text/javascript"></script>
<link href="__JS__/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />

<script src="__JS__/echart/echarts.min.js" type="text/javascript"></script>
<script src="__JS__/echart/macarons.js"></script>
<script src="__JS__/echart/china.js"></script>
<script>
    var res = {$result};
    console.log(res);
    var myChart = echarts.init(document.getElementById('statistics'),'macarons');
    option = {
        tooltip : {
            trigger: 'axis'
        },
        toolbox: {
            show : true,
            feature : {
                mark : {show: true},
                dataView : {show: true, readOnly: false},
                magicType: {show: true, type: ['line', 'bar']},
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        calculable : true,
        legend: {
            data:['交易金额','订单数','客单价']
        },
        xAxis : [
            {
                type : 'category',
                data : res.time
            }
        ],
        yAxis : [
            {
                type : 'value',
                name : '金额',
                axisLabel : {
                    formatter: '{value} ￥'
                }
            },
            {
                type : 'value',
                name : '客单价',
                axisLabel : {
                    formatter: '{value} ￥'
                }
            }
        ],
        series : [
            {
                name:'交易金额',
                type:'bar',
                data:res.amount
            },
            {
                name:'订单数',
                type:'bar',
                data:res.order
            },
            {
                name:'客单价',
                type:'line',
                yAxisIndex: 1,
                data:res.sign
            }
        ]
    };
    myChart.setOption(option);
    $(document).ready(function() {
        $('#start_time').daterangepicker({
            format:"YYYY-MM-DD",
            singleDatePicker: false,
            showDropdowns: true,
            minDate:'2016-01-01',
            maxDate:'2030-01-01',
            startDate:'2016-01-01',
            showWeekNumbers: true,
            timePicker: false,
            timePickerIncrement: 1,
            timePicker12Hour: true,
            ranges: {
                '今天': [moment(), moment()],
                '昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
                '最近7天': [moment().subtract('days', 6), moment()],
                '最近30天': [moment().subtract('days', 29), moment()],
                '上一个月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
            },
            opens: 'right',
            buttonClasses: ['btn btn-default'],
            applyClass: 'btn-small btn-primary',
            cancelClass: 'btn-small',
            locale : {
                applyLabel : '确定',
                cancelLabel : '取消',
                fromLabel : '起始时间',
                toLabel : '结束时间',
                customRangeLabel : '自定义',
                daysOfWeek : [ '日', '一', '二', '三', '四', '五', '六' ],
                monthNames : [ '一月', '二月', '三月', '四月', '五月', '六月','七月', '八月', '九月', '十月', '十一月', '十二月' ],
                firstDay : 1
            }
        });
    });
</script>

<!--修改分类-->
<script type="text/javascript">
 $(".cancle").click(function(){
        $(this).parent().parent('.jbox').hide();
        $('#albums-overlay').hide();
        $(".quxiao").hide();
    })
 var id ='';
 $(".j-editClass").click(function(){
        id = $(this).attr("data-id");
        $('.editfenlei').show();
        $('#albums-overlay').show();
});

 $("#fahuo").click(function(){
     var data = {};
        data.express_name    = $.trim($("select[name=express_name]").val());
        // data.express_fee     = $.trim($("input[name=express_fee]").val());
        data.express_no         = $.trim($("input[name=express_no]").val());
        if(!data.express_name){
            alert("请选择物流公司！");return false;
        }
        if(!data.express_no){
            alert("请填写快递单号！");return false;
        }
        data.id = id ;
        $.ajax({
            url:"{:U('Admin/Order/express')}",
            type:'post',
            data :data,
            datatype : 'json',
            success:function(data){
                if(data.status==1){
                    alert(data.info);
                    location.href="{:U('Admin/Order/index')}";
                }else{
                    alert(data.info);
                }
            }
        });
 });

$(function(){
    $(".dealorder").click(function(){
        var id    = $(this).attr("data-id");
        var name  = $(this).attr("data-name");
        if(!id){
            alert("无效的选择！");return false;
        }
        if(!confirm("确认处理订单编号为：【"+name+"】的订单？操作不可逆！")){
            return false;
        }
        $.post("{:U('admin/Order/dealOrder')}",{id:id},function(data){
            alert(data.info);
            if(data.status == 1){
                window.location.reload();
            }
        },"json")
    })

});

$(".j-addNote").click(function(){
    $('.addNoteInfo').show();
    $('#note-overlay').show();
    var note_orderid=$(this).attr('data-id');
    $('#note_orderid').val(note_orderid);
    $('#addNoteInfo').val('');
});

$("#saveNoteInfo").click(function(){
    var note_info = $('#addNoteInfo').val();
    var note_orderid=$('#note_orderid').val();
    if (note_info == '') {
        alert("备注信息必填！");
        return false;
    }
    $.ajax({
        url: "{:U('/Admin/Order/addNote')}",
        type: "post",
        dataType: "json",
        data: {
            note_info: note_info,
            note_orderid: note_orderid
        }
    }).done(function (g) {
        if (g.status == 1) {
            alert(g.info);
            window.location.reload();
        } else {
            alert(g.info);
        }
    })
})

</script>