<include file="Public:header" />

<div class="ban1">
  <div class="banner_img"> <img src="__IMAGES__/xinwen.jpg" alt="" /> </div>
</div>

<!--  / warpper  -->

<div class="warpper wrapper1 wrapper_s1">
  <div class="zhenggLcTitle">
    <h3>{$theme['theme']}主题大赛征稿<span><if condition = "$timed gt $theme['end_time']">已经结束<elseif condition = "$timed lt $theme['start_time']"/>还未开始<elseif condition = "$timed gt $theme['collectiontime'] and $timed elt $theme['selectiontime']"/>评选中<elseif condition="$timed gt $theme['selectiontime'] and $timed elt $theme['end_time']"/>公布结果中<else />进行中</if>...</span></h3>
    <div class="zggLcNav"> 
      <a href="{:U('/Home/News/process')}">大赛流程</a>
      <a href="{:U('/Home/News/processDetails')}">大赛详情</a>
      <!-- <a href="{:U('/Home/News/submission')}" class="zggLcNavCur">在线投稿</a> -->
      <a href="{:U('/Home/News/works')}">在线作品</a>
      <a href="{:U('/Home/News/win')}">获奖作品</a></div>
  </div>
  <input type="hidden" name="member_id" value="{$Think.session.member_id}" id="member_id"/>
  <form class="warpForm" name='formw' method='post' onsubmit="return toVaild()">
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">真实姓名:</span> </div>
      <div class="busapply_xinxi_right">
        <input type="text" name="author" maxlength="10" onblur="value=value.replace(/[^\u4e00-\u9fa5]/g,'')" onkeyup="value=value.replace(/[^\u4e00-\u9fa5]/g,'')" id="author" value="{$mem['realname']}"/>
      </div>
    </div>
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">身份证号:</span> </div>
      <div class="busapply_xinxi_right">
        <input type="text" name="sfid" maxlength="30" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" id="sfid" value=""/>
      </div>
    </div>
	<div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">作者简介:</span> </div>
      <div class="busapply_xinxi_right">
        <textarea name="person_detail" maxlength="100" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" id="person_detail" ></textarea>
      </div>
    </div>
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">出生日期:</span> </div>
      <div class="busapply_xinxi_right">
       <input id="dateinfo" type="text" maxlength="30" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" name="bir"  value="{$mem['birth']}" />
		  <!-- <input id="dateinfo" type="date" class="input" name="bir" id="bir" value="{$mem['birth']}"> -->
      </div>
    </div>
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">手机号码:</span> </div>
      <div class="busapply_xinxi_right">
        <input type="text" name="phone" maxlength="16" onblur="value=value.replace(/[^0-9]/g,'')" onkeyup="value=value.replace(/[^0-9]/g,'')" id="phone" value="{$mem['telephone']}"/>
      </div>
    </div>
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">邮箱地址:</span> </div>
      <div class="busapply_xinxi_right">
        <input type="text" name="email" maxlength="30" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" id="email" value="{$mem['email']}"/>
      </div>
    </div>
      <div class="busapply_xinxi_input">
          <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">作品名称:</span> </div>
          <div class="busapply_xinxi_right">
              <input type="text" name="wname" maxlength="30" onblur="value=value.replace(/\s/g,'')" onkeyup="value=value.replace(/\s/g,'')" id="wname" value=""/>
          </div>
      </div>
      <div class="busapply_xinxi_input">
          <!--   <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">作品类型:</span> </div> -->
          <div class="busapply_xinxi_right">
              <volist name="attrList" id="val">
                  <div class="product-sort shaixuan-box">
                      <!--<div class="quality">-->
                          <div class="busapply_xinxi_left" style="width: 102px;"> <span
                                  class="busapply_xinxi_span1">*
                          </span>
                              {$val.classname}: </div><input type="hidden" id="a3">
                          <!-- <a href="javacript:;" data-attr_id="0" class="range active">全部</a> -->
                          <div class="busapply_xinxi_right" style="margin-top: 10px;">
                          <volist name="val.child" id="vv">

                              <a href="javascript:;" data-attr_id="{$vv.id}" data-name="{$val.classname}" class="range"> {$vv.classname}</a>

                          </volist>
                          </div>
                      <!--</div>-->
                  </div>
              </volist>
          </div><input type="hidden" name="zpbute" value="" id="zpbute"/>
      </div>
    <div class="busapply_xinxi_input">
      <div class="busapply_xinxi_left"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">详细介绍:</span> </div>
      <div class="busapply_xinxi_right">
        <textarea name="zuo_detail" maxlength="200" id="zuo_detail" ></textarea>
      </div>
    </div>
    <div class="busapply_pic">
      <div class="busapply_xinxi_pic"> <span class="busapply_xinxi_span1">*</span> <span class="busapply_xinxi_span2">上传作品(最多可以上传五张图片):</span> </div>
      <div class="busapply_xinxi_shang">
		
        <div class="busapply_xinxi_shangch">
			<input type="file" name="prize_3" id="prize_3" class="file" />
			<div class="prize_3_showimge" style='width:100px;height:100px;'> <div class='sc'><span style=''>上传图片</span> <br/><!--<i>×</i>--></div></div>	
			<div class="prize_3 fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="prize_3_prize">80%</span> </div>
		  <p>(宽247高247)</p>
	</div>
		
        <div class="busapply_xinxi_shangch">
			  <input type="file" name="prize_4" id="prize_4" class="second"/>
			 	<div class="prize_4_showimge" style='width:100px;height:100px;'> <div class='sc'><span style=''>上传图片</span> <!--<i>×</i>--></div></div>	
				<div class="prize_4 fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="prize_4_prize">80%</span> </div>
			<p>(宽622高475)</p>
		</div>
		
		 <div class="busapply_xinxi_shangch">
			<input type="file" name="prize_5" id="prize_5" class="file" />
			<div class="prize_5_showimge" style='width:100px;height:100px;'> <div class='sc'><span style=''>上传图片</span><!--<i>×</i>--></div></div>	
			<div class="prize_5 fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="prize_5">80%</span> </div>
			(宽622高475)
		</div>
		
		 <div class="busapply_xinxi_shangch">
			<input type="file" name="prize_6" id="prize_6" class="file" />
			<div class="prize_6_showimge" style='width:100px;height:100px;'> <div class='sc'><span style=''>上传图片</span><!--<i>×</i>--></div></div>	
			<div class="prize_6 fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="prize_6">80%</span> </div>
		<p>(宽622高475)</p>
		</div>
		
		 <div class="busapply_xinxi_shangch">
			<input type="file" name="prize_7" id="prize_7" class="file" />
			<div class="prize_7_showimge" style='width:100px;height:100px;'> <div class='sc'><span style=''>上传图片</span><!--<i>×</i>--> </div></div>	
			<div class="prize_7 fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="prize_7">80%</span> </div>
		<p>(宽622高475)</p>
		</div>
		
        <!-- <div class="busapply_xinxi_shangch busapply_xinxi_shangchspan"> <span>+</span> </div>  -->
      </div>
    </div>
    <a href="javascript:;" class="busapply_tijiao">提交</a>
  </form>
  <div class="top"> <a class="top_a" href="javascript:goTop();"> <img src="__IMAGES__/top.png"> </a> </div>
</div>
<!--  / warpper  -->

<include file="Public/footer" />

</body>

<!--上传图片-->

<script type="text/javascript" src="__JS__/jquery.js"></script>

<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script type="text/javascript" src="__JS__/jeDate/jedate.js"></script>

  <script type="text/javascript">
    function toVaild(){
        var author = $.trim($('#author').val());
        var sfid = $.trim($('#sfid').val());
        var phone = $.trim($('#phone').val());
        var email = $.trim($('#email').val());
        var wname = $.trim($('#wname').val());
        var bir = $('#dateinfo').val();

        var zuo_detail = $.trim($('#zuo_detail').val());
        var person_detail = $.trim($('#person_detail').val());
        var pic3 = $('#pic3').val();
        var pic4 = $('#pic4').val();
        var pic5 = $('#pic5').val();
        var pic6 = $('#pic6').val();
        var pic7 = $('#pic7').val();
		author = author.replace(/\s+/g,"");
        if(author==""){
            alert('作者姓名不能为空');
            return false;
        }
		sfid = sfid.replace(/\s+/g,"");
		if(sfid==""){
            alert('身份证不能为空且要跟真实姓名对应');
            return false;
        }

        if(!IdentityCodeValid(sfid)){
            return IdentityCodeValid(sfid);
        }
		person_detail = person_detail.replace(/\s+/g,"");
		if(person_detail == ''){
            alert('作者简介不能为空');
            return false;
        }
		phone = phone.replace(/\s+/g,"");
        if(phone == ''){
            alert('手机不能为空');
            return false;
        }
		
		email = email.replace(/\s+/g,"");
        if(email == ''){
            alert('邮箱不能为空');
            return false;
        }
		wname = wname.replace(/\s+/g,"");
        if(wname == ''){
            alert('作品名称不能为空');
            return false;
        }
		zuo_detail = zuo_detail.replace(/\s+/g,"");
        if(zuo_detail == ''){
            alert('详细介绍不能为空');
            return false;
        }
      
        if(pic3 == undefined && pic4 == undefined && pic5 == undefined && pic6 == undefined && pic7 == undefined){
            alert('至少上传一张作品图片');
            return false;
        }
        if(bir == ''){
            alert('生日不能为空');
            return false;
        }
        var bir1 = new Date(bir);
        var b1 = bir1.getTime();
        var time = new Date();
        var t1 = time.getTime();
        //console.log(bir,b1,t1);return false;
        if(b1 > t1){
        	alert('生日不能晚于当前时间！');return false;
        }
		return true;
		


}
//身份证验证
function IdentityCodeValid(code) { 
            var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
            var tip = "";
            var pass= true;
            
            if(!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
                tip = "身份证号格式错误";
                pass = false;
            }
            
           else if(!city[code.substr(0,2)]){
                tip = "地址编码错误";
                pass = false;
            }
            else{
                //18位身份证需要验证最后一位校验位
                if(code.length == 18){
                    code = code.split('');
                    //∑(ai×Wi)(mod 11)
                    //加权因子
                    var factor = [ 7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2 ];
                    //校验位
                    var parity = [ 1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2 ];
                    var sum = 0;
                    var ai = 0;
                    var wi = 0;
                    for (var i = 0; i < 17; i++)
                    {
                        ai = code[i];
                        wi = factor[i];
                        sum += ai * wi;
                    }
                    var last = parity[sum % 11];
                    if(parity[sum % 11] != code[17]){
                        tip = "身份证错误";//校验位错误
                        pass =false;
                    }
                }
            }
            if(!pass) alert(tip);
            return pass;
        }
</script>
<script>
		$(document).ready(function(){
			//身份证验证

			
		})
		$('.product-sort a').click(function(){
		  $(this).parent().find('a').removeClass('active')
		  $(this).addClass('active')
		});
		$('.busapply_xinxi_shangchspan').click(function() {
			
				<!-- if($('.busapply_xinxi_shang input:[type="file"]').length >= 5){ -->
					<!-- alert('最多只能上传五幅作品！'); -->
					<!-- return false; -->
				<!-- } -->
			$(this).before('<div id="1" class="busapply_xinxi_shangch"><input type="file" /><span>上传图片</span><i>×</i></div>'); 
			 //$(this).before(' <div class="busapply_xinxi_shangch"> <input type="file"/></div>'); 
				
			$('.busapply_xinxi_shangch i').click(function(){
				$(this).parent().remove();
				$('.busapply_xinxi_shangch').parent('div').remove();
			});
		  
			
		});
		
		
		

		$('.busapply_xinxi_shangch i').unbind("click");
		  $('.busapply_xinxi_shangch i').click(function(){
		  $(this).parent().remove();
		});
		
		jeDate.skin('gray');
		jeDate({
			dateCell:"#dateinfo",
			format:"YYYY-MM-DD",
			isinitVal:true,
			isTime:true, //isClear:false,
			minDate:"1950-01-01",
			okfun:function(val){
				//alert(val);
			}
		})
		
	
	
  
	$(function(){
		if(!$('#member_id').val()){
			dialog.showTips("请先注册，若有账号，请先登录！", "",'/Home/User/login');
			return false;
		}
		//first_prize
		var percent = $('.prize_3_prize');
		var progress = $('.prize_3');
		$("#prize_3").wrap("<form id='prizes_3' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#prize_3").change(function(){ //选择文件
		  $("#prizes_3").ajaxSubmit({
			dataType:  'json', //数据格式为json
			beforeSend: function() { //开始上传
			  //progress.show(); //显示进度条
			  var percentVal = '0%';
			  percent.html(percentVal);
			},
			uploadProgress: function(event, position, total, percentComplete) {
			  var percentVal = percentComplete + '%'; //获得进度
			  percent.html(percentVal); //显示上传进度百分比
			},
			success: function(data) { //成功
				console.log(data);
			  var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="100" width="100" ><input type="hidden" name="pic3" id="pic3" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
			   $('.prize_3_showimge').html(img+"<i>×</i>");
			  //$('.sc').hide();
			  progress.hide();
			 $('.busapply_xinxi_shangch .prize_3_showimge i').click(function(){
				//$(this).remove();
				var src = data[0]["savepath"].substr(1)+data[0]["savename"];
				console.log(src);
				$.ajax({
					url:"/Home/News/delImage",
					type:'post',
					data:{src:src},
					dataType:'json',
					success: function(g){
						console.log(g);
					}
				})
				var div = "<div class='sc'><span>上传图片</span></div>"; 
				$('.prize_3_showimge').html(div);
				//$('.busapply_xinxi_shangch ').parent('div').remove();
			 })
			},
			error:function(xhr){ //上传失败
			  console.log(xhr.status)
			}
		  });
		});
		//second_prize
		var percent = $('.prize_4');
		var progress = $('.prize_4');
		$("#prize_4").wrap("<form id='prizes_4' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#prize_4").change(function(){ //选择文件
		  $("#prizes_4").ajaxSubmit({
			dataType:  'json', //数据格式为json
			beforeSend: function() { //开始上传
			  //progress.show(); //显示进度条
			  var percentVal = '0%';
			  percent.html(percentVal);
			},
			uploadProgress: function(event, position, total, percentComplete) {
			  var percentVal = percentComplete + '%'; //获得进度
			  percent.html(percentVal); //显示上传进度百分比
			},
			success: function(data) { //成功
			
			  var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="100" width="100" ><input type="hidden" name="pic4" id="pic4" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
			   $('.prize_4_showimge').html(img+"<i>×</i>");
			  $('.sc').hide();
			  progress.hide();
			  $('.busapply_xinxi_shangch .prize_4_showimge i').click(function(){
					//$(this).remove();
					var src = data[0]["savepath"].substr(1)+data[0]["savename"];
					console.log(src);
					$.ajax({
						url:"/Home/News/delImage",
						type:'post',
						data:{src:src},
						dataType:'json',
						success: function(g){
							console.log(g);
						}
					})
					var div = "<div class='sc'><span>上传图片</span> <br/></div>"; 
					$('.prize_4_showimge').html(div);
					//$('.busapply_xinxi_shangch ').parent('div').remove();
				});
			},
			error:function(xhr){ //上传失败
			  console.log(xhr.status)
			}
		  });
		});
		
		//
		//third_prize
		var percent = $('.prize_5');
		var progress = $('.prize_5');
		$("#prize_5").wrap("<form id='prizes_5' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#prize_5").change(function(){ //选择文件
		  $("#prizes_5").ajaxSubmit({
			dataType:  'json', //数据格式为json
			beforeSend: function() { //开始上传
			  //progress.show(); //显示进度条
			  var percentVal = '0%';
			  percent.html(percentVal);
			},
			uploadProgress: function(event, position, total, percentComplete) {
			  var percentVal = percentComplete + '%'; //获得进度
			  percent.html(percentVal); //显示上传进度百分比
			},
			success: function(data) { //成功
			
			  var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="100" width="100" ><input type="hidden" name="pic5" id="pic5" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
			   $('.prize_5_showimge').html(img+"<i>×</i>");
			  $('.sc').hide();
			  progress.hide();
			  $('.busapply_xinxi_shangch .prize_5_showimge i').click(function(){
					//$(this).remove();
					var src = data[0]["savepath"].substr(1)+data[0]["savename"];
					console.log(src);
					$.ajax({
						url:"/Home/News/delImage",
						type:'post',
						data:{src:src},
						dataType:'json',
						success: function(g){
							console.log(g);
						}
					})
					var div = "<div class='sc'><span>上传图片</span> <br/></div>"; 
					$('.prize_5_showimge').html(div);
					//$('.busapply_xinxi_shangch ').parent('div').remove();
				});
			},
			error:function(xhr){ //上传失败
			  console.log(xhr.status)
			}
		  });
		});
		
		//four_prize
		var percent = $('.prize_6');
		var progress = $('.prize_6');
		$("#prize_6").wrap("<form id='prizes_6' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#prize_6").change(function(){ //选择文件
		  $("#prizes_6").ajaxSubmit({
			dataType:  'json', //数据格式为json
			beforeSend: function() { //开始上传
			  //progress.show(); //显示进度条
			  var percentVal = '0%';
			  percent.html(percentVal);
			},
			uploadProgress: function(event, position, total, percentComplete) {
			  var percentVal = percentComplete + '%'; //获得进度
			  percent.html(percentVal); //显示上传进度百分比
			},
			success: function(data) { //成功
			
			  var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="100" width="100" ><input type="hidden" name="pic6" id="pic6" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
			   $('.prize_6_showimge').html(img+"<i>×</i>");
			  $('.sc').hide();
			  progress.hide();
			  $('.busapply_xinxi_shangch .prize_6_showimge i').click(function(){
					//$(this).remove();
					var src = data[0]["savepath"].substr(1)+data[0]["savename"];
					console.log(src);
					$.ajax({
						url:"/Home/News/delImage",
						type:'post',
						data:{src:src},
						dataType:'json',
						success: function(g){
							console.log(g);
						}
					})
					var div = "<div class='sc'><span>上传图片</span> <br/></div>"; 
					$('.prize_6_showimge').html(div);
					//$('.busapply_xinxi_shangch ').parent('div').remove();
				});
			},
			error:function(xhr){ //上传失败
			  console.log(xhr.status)
			}
		  });
		});
		
		//five_prize
		var percent = $('.prize_7');
		var progress = $('.prize_7');
		$("#prize_7").wrap("<form id='prizes_7' action='{:U('/Home/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
		$("#prize_7").change(function(){ //选择文件
		  $("#prizes_7").ajaxSubmit({
			dataType:  'json', //数据格式为json
			beforeSend: function() { //开始上传
			  //progress.show(); //显示进度条
			  var percentVal = '0%';
			  percent.html(percentVal);
			},
			uploadProgress: function(event, position, total, percentComplete) {
			  var percentVal = percentComplete + '%'; //获得进度
			  percent.html(percentVal); //显示上传进度百分比
			},
			success: function(data) { //成功
			
			  var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="100" width="100" ><input type="hidden" name="pic7" id="pic7" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
			   $('.prize_7_showimge').html(img+"<i>×</i>");
			  $('.sc').hide();
			  progress.hide();
			  $('.busapply_xinxi_shangch .prize_7_showimge i').click(function(){
					//$(this).remove();
					var src = data[0]["savepath"].substr(1)+data[0]["savename"];
					console.log(src);
					$.ajax({
						url:"/Home/News/delImage",
						type:'post',
						data:{src:src},
						dataType:'json',
						success: function(g){
							console.log(g);
						}
					})
					var div = "<div class='sc'><span>上传图片</span> <br/></div>"; 
					$('.prize_7_showimge').html(div);
					//$('.busapply_xinxi_shangch ').parent('div').remove();
				});
			},
			error:function(xhr){ //上传失败
			  console.log(xhr.status)
			}
		  });
		});
		
		//提交表单
		$('.busapply_tijiao').click(function(){
            //身份证验证
            var sfid = $.trim($('#sfid').val());
            if(sfid == ""){
                alert('请输入身份证');
                return false;

            }
            if(!IdentityCodeValid(sfid)){
                return IdentityCodeValid(sfid);
            }

            //对电子邮件的验证
            var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            if(!myreg.test($.trim($('#email').val()))){
                alert('提示\n\n请输入有效的E_mail！');
                myreg.focus();
                return false;
            }

            //手机的验证
            var mobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/;
            if(!mobile.test($.trim($('#phone').val()))){

                alert('提示\n\n请输入有效的手机号！');
                mobile.focus();
                return false;
            }



            var ids = "";
            $('.busapply_xinxi_right .active').each(function(){
                var attr_id = $(this).data('attr_id');
                ids = ids + attr_id + ",";
            })
		//提交ajax验证
			//一个人一期只能投稿一次
            var rang = $('.busapply_xinxi_right .active').length;
            var countattr = parseInt('{$counattr}');
            //console.log(rang,countattr);return false;
            if(rang === '' || rang === null){
                alert('请选择作品属性！');return false;
            }
            if(rang < countattr){
                alert('请选择作品属性！');return false;
            }

            if(ids != ''){
                $('#zpbute').val(ids);
            }
           //console.log(ids);return false;
			$.ajax({
				type:'get',
				url:'/Home/News/submission',
				data:{},
				dataType:'json',
				success: function(g){
					if(g.status == 0){
						alert(g.info);
						return false;
					}else{
						if(toVaild()){
							$('.warpForm').action="/Home/News/submission";
							$('.warpForm').submit();
						}else{
							return toVaild();
						}
						
					}
				}
			})
			
			
		})
		
		$('#wsize').change(function(){
			var cid = $('#wsize').val();
		
			$.ajax({
				url:"{:U('Home/News/cc_detail')}",
				type:'post',
				data:{id:cid},
				dataType:'json',
				success:function(g){
					if(g.status){
						var html = "<span style='margin-top:20px;'>"+g.min+"~"+g.max+"cm</span>";
						$("#cc").html(html);
					}else{
						
					}
				}
			});
		});
	})
	
/******最完美解决 图片在图片框内按宽高比例自动缩放！！！***/  
        //Img:要放图片的img元素，onload时传参可用this  
  
        //maxHeight  :img元素的高度，像素（图片框 最大高度）  
  
        //maxWidth:img元素的宽度，像素（图片框 最大宽度）  
        function AutoSize(Img, maxWidth, maxHeight) {  
            var image = new Image();  
            //原图片原始地址（用于获取原图片的真实宽高，当<img>标签指定了宽、高时不受影响）  
            image.src = Img.src;    
            // 当图片比图片框小时不做任何改变   
            if (image.width < maxWidth&& image.height < maxHeight) {  
                Img.width = image.width;  
                Img.height = image.height;  
            }  
            else //原图片宽高比例 大于 图片框宽高比例,则以框的宽为标准缩放，反之以框的高为标准缩放 
			{  
            if (maxWidth/ maxHeight  <= image.width / image.height) //原图片宽高比例 大于 图片框宽高比例  
            {  
                Img.width = maxWidth;   //以框的宽度为标准  
                Img.height = maxWidth* (image.height / image.width);  
            }   
            else {   //原图片宽高比例 小于 图片框宽高比例  
                Img.width = maxHeight  * (image.width / image.height);  
                Img.height = maxHeight  ;   //以框的高度为标准  
            }  
        }  
  
		}  
</script>
</html>